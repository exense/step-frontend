function downloadCSV(a){var a,b,c,d=convertArrayOfObjectsToCSV(a);if(null!=d)if(b="perf-export.csv",a=encodeURI(d),msieversion()){var e=window.open();e.document.write(d),e.document.close(),e.document.execCommand("SaveAs",!0,b),e.close()}else d.match(/^data:text\/csv/i)||(a="data:text/csv;charset=utf-8,"+a),c=document.createElement("a"),c.setAttribute("href",a),c.setAttribute("id","tempDownloadElement"),c.setAttribute("download",b),$("#tempHolder").append(c),c.click()}function msieversion(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return b>0||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1}function convertArrayOfObjectsToCSV(a){var b="";return _.each(a.headers,function(a){b+=a+","}),b=b.substring(0,b.length-1),b+="\n",_.each(a.data,function(a){_.each(a,function(a){b+=a+","}),b=b.substring(0,b.length-1),b+="\n"}),b}function AbstractIdentifiableObject(a,b){this._id=a,this.customFields=b}function AbstractOrganizableObject(a,b,c){AbstractIdentifiableObject.call(this,a,b),this.attributes=c}function Dashboard(a,b,c){return{oid:a,dstate:b,type:c}}function Widget(a,b,c){return{oid:a,wstate:b,state:c}}function Dashlet(a,b){return{oid:a,state:b}}function WidgetState(a,b,c){return{widgetwidth:a,autorefresh:b,chevron:c}}function Info(a){return{showraw:a,alert:{message:"",counter:0},http:{}}}function Gui(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return{status:{open:{presets:a,loadconfig:b,display:c,coms:d,subscribeto:e,execution:f,info:g,presetquery:h,presetcontrols:i,service:j,input:k,preproc:l,postproc:m,manage:n},disabled:{manage:!1}},chartdata:o,tabledata:p}}function DashletState(a,b,c,d,e,f,g,h,i){return{title:a,viewtoggle:b,tabindex:c,data:d,options:{innercontainer:{height:0,width:0},chart:e},config:f,global:{},info:i,gui:h,query:g}}function DashletData(a,b,c){return{transformed:a,rawresponse:b,state:c}}function Config(a,b,c,d,e,f,g,h,i,j){return{toggleaction:a,autorefresh:b,master:c,slave:d,target:e,autorefreshduration:f,asyncrefreshduration:g,incremental:h,incmaxdots:i,transposetable:j}}function DashboardState(a,b,c,d,e){return{globalsettings:a,widgets:b,title:c,displaytype:d,dashboardgui:e}}function DashboardGui(a){return{inputopen:a}}function GlobalSettings(a,b,c,d,e){return{placeholders:a,autorefresh:b,chevron:c,name:d,intervalduration:e}}function ChartOptions(a,b,c,d,e,f,g,h,i,j){var k={type:a,height:window.innerHeight/4,width:0,colorFunction:h,margin:{top:20,right:20,bottom:55,left:60},showLegend:!1,forceY:0,xAxis:{tickFormat:{},strTickFormat:d,rotateLabels:-23},yAxis:{tickFormat:{},strTickFormat:e},dualzx:i,dualtranspose:j};return f&&(k.xAxis.strScale=f),g&&(k.yAxis.strScale=g),"stackedAreaChart"===a?(k.useVoronoi=!1,k.showControls=!1,k.clipEdge=!0,k.duration=0,k.useInteractiveGuideline=!0,k.showLegend=!1,k.zoom={enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!0,verticalOff:!0,unzoomEventType:"dblclick.zoom"}):(k.stacked=c,k.useInteractiveGuideline=b,k.x=function(a){return a.x},k.y=function(a){return a.y},k.showLegend=!1,k.scatter={onlyCircles:!1}),k}function Preproc(a){return{replace:{"function":a}}}function Transformation(a,b){return{"function":a,args:b}}function Postproc(a,b,c,d,e){return{asyncEnd:{"function":a},transform:{"function":b,args:c,transformations:e},save:{"function":d}}}function Service(a,b,c,d,e){return{url:a,method:b,data:c,preproc:d,postproc:e}}function Callback(a,b,c,d,e){return new Service(a,b,c,d,e)}function SimpleQuery(a,b){return{inputtype:a,type:"Simple",datasource:{service:b}}}function AsyncQuery(a,b,c){return{inputtype:a,type:"Async",datasource:{service:b,callback:c}}}function Placeholder(a,b,c){return{key:a,value:b,isDynamic:c}}function TemplatePreset(a,b,c,d,e){return new Preset(a,new Template(b,c,d,e))}function Preset(a,b){return{name:a,preset:b}}function TemplatedQuery(a,b,c,d){return{inputtype:"Template",controltype:a,type:b.type,datasource:b.datasource,paged:c,controls:d}}function Offset(a,b,c,d){return{vid:a,start:b,next:c,previous:d}}function Paging(a,b,c){return{ispaged:a,offsets:{first:b,second:c}}}function Controls(a){return{template:a}}function Template(a,b,c,d){return{templatedPayload:a,templatedParams:b,placeholders:c,queryTemplate:d}}function DefaultGlobalSettings(){return new GlobalSettings([],!1,!1,"Global Settings",3e3)}function DefaultDashboardState(a){return a||(a=[new DefaultWidget]),new DashboardState(new DefaultGlobalSettings,a,"Viz Dashboard","aggregated",new DefaultDashboardGui)}function DefaultDashboard(a){return new Dashboard(getUniqueId(),new DefaultDashboardState(a),"viz")}function DefaultExplorationDashboard(){return new Dashboard(getUniqueId(),new DashboardState(new DefaultGlobalSettings,[new ExplorationDashlet],"Explore Dashboard","exploded",new DefaultDashboardGui),"viz")}function DefaultDashboardGui(){return new DashboardGui(!0)}function DefaultConfig(){return new Config("Fire","Off",!1,!1,"",3e3,1e3,"Off",8,"Off")}function DefaultQuery(){return new DefaultSimpleQuery}function DefaultSimpleQuery(){return new SimpleQuery("Raw",new DefaultService)}function DefaultAsyncQuery(){return new AsyncQuery("Raw",new DefaultService,new DefaultCallback)}function DefaultService(){return new Service("","Get","",new DefaultPreproc,new DefaultPostproc)}function DefaultCallback(){return new Callback("","Get","",new DefaultPreproc,new DefaultPostproc)}function DefaultPreproc(){return new Preproc(DefaultReplaceFunc())}function DefaultPostproc(){return new Postproc(DefaultAsyncEndFunc(),DefaultTransformFunc(),[],DefaultSaveFunct(),{})}function DefaultAsyncEndFunc(){return"function(response){\r	return response.myEndBoolean;\r}"}function DefaultTransformFunc(){return"function (response, args) {\r	return [];\r}"}function DefaultReplaceFunc(){return"function(requestFragment, workData){\r	for(i=0;i<workData.length;i++){\r		requestFragment = requestFragment.replace(workData[i].key, workData[i].value);\r	}\r	return requestFragment;\r}"}function DefaultSaveFunct(){return"function(response){\r	return [\r		{\r			key : '__mykey__', value : response.status, isDynamic : false\r		}\r	];\r}"}function DefaultInfo(){return new Info("Off")}function DefaultControls(){return new Controls({})}function DefaultTemplatedQuery(){return new TemplatedQuery("Plain",new DefaultQuery,new DefaultPaging,new DefaultControls)}function DefaultTemplate(){return new Template("","",[],new DefaultTemplatedQuery)}function DefaultChartOptions(){return new ChartOptions("lineChart",!1,!1,'function (d) {\r\n    var value;\r\n    if ((typeof d) === "string") {\r\n        value = parseInt(d);\r\n    } else {\r\n        value = d;\r\n    }\r\n\r\n    return $scope.toDynamicDateFormat(value);\r\n}',"function (d) { return d.toFixed(1); }",null,null,stringToColour)}function DefaultDashletData(){return new DashletData(null,null,null)}function DefaultGuiClosed(){return new Gui(!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,null,null)}function DefaultGuiOpen(){return new Gui(!0,!1,!0,!0,!1,!0,!0,!1,!1,!0,!0,!0,!0,!0,null,null)}function DefaultDashletState(){return new DashletState("New Dashlet",!0,0,new DefaultDashletData,new DefaultChartOptions,new DefaultConfig,new DefaultQuery,new DefaultGuiClosed,new DefaultInfo)}function ExplorationDashletState(){return new DashletState("New Exploration Dashlet",!0,0,new DefaultDashletData,new DefaultChartOptions,new DefaultConfig,new DefaultQuery,new DefaultGuiOpen,new Info("On"))}function ExplorationDashlet(){return new Dashlet(getUniqueId(),new ExplorationDashletState)}function DefaultWidget(){return new Widget(getUniqueId(),new DefaultWidgetState,new DefaultDashletState)}function DefaultWidgetState(){return new WidgetState("col-md-6",!1,!0)}function DefaultPaging(){return new Paging("Off",{},{})}function Filter(a,b){return{type:a,key:b}}function TextFilter(a,b,c){var d=new Filter("text",a);return d.value=b,d.regex=c,d}function NumericalFilter(a,b,c){var d=new Filter("numerical",a);return d.minValue=b,d.maxValue=c,d}function DateFilter(a,b,c){var d=new Filter("date",a);return d.minDate=b,d.maxDate=c,d}function Selector(a,b){return{textFilters:a,numericalFilters:b}}function ServiceParams(a,b,c,d,e,f,g,h,i,j){return{"aggregateService.cpu":a,"aggregateService.granularity":b,"aggregateService.groupby":c,"aggregateService.partition":d,"aggregateService.sessionId":e,"aggregateService.timeout":f,"measurementService.nextFactor":g,"aggregateService.timeField":h,"aggregateService.timeFormat":i,"aggregateService.valueField":j}}function RTMPayload(a,b){return{selectors1:a,serviceParams:b}}function DefaultTextFilter(){return new TextFilter("eId","","Off")}function DefaultNumericalFilter(){return new NumericalFilter("value",0,1)}function DefaultDateFilter(){return new DateFilter("begin",new Date((new Date).getTime()-36e5),new Date)}function DefaultSelector(){return{textFilters:[],numericalFilters:[]}}function EidSelector(a){return{textFilters:[new TextFilter("eId",a,!1)],numericalFilters:[]}}function DefaultServiceParams(){return new ServiceParams("1","auto","name","8","defaultSid","600","__FACTOR__","begin","long","value")}function DefaultRTMPayload(){return new RTMPayload([new DefaultSelector],new DefaultServiceParams)}function StepRTMPayload(){return new RTMPayload([new EidSelector],new DefaultServiceParams)}function RTMAggregatesMasterQuery(){var a=new DefaultAsyncQuery;a.controls=new DefaultControls,a.paged=new DefaultPaging,a.controltype="RTM",a.controls.querytype="aggregates";var b=function(a,b){var c=(b.metric,b.metric.split(";")),d=[],e=a.data.payload.stream.streamData,f=Object.keys(e);for(i=0;i<f.length;i++){var g=Object.keys(e[f[i]]);for(j=0;j<g.length;j++)$.each(c,function(a,b){b&&e[f[i]][g[j]][b]&&d.push({x:f[i],y:e[f[i]][g[j]][b],z:g[j]})})}return d},c=b.toString();return a.type="Async",a.datasource={service:new Service("/rtm/rest/aggregate/get","Post","",new Preproc("function(requestFragment, workData){var newRequestFragment = requestFragment;for(i=0;i<workData.length;i++){newRequestFragment = newRequestFragment.replace(workData[i].key, workData[i].value);}return newRequestFragment;}"),new Postproc("","",[],"function(response){if(!response.data.payload){console.log('No payload ->' + JSON.stringify(response)); return null;}return [{ placeholder : '__streamedSessionId__', value : response.data.payload.streamedSessionId, isDynamic : false }];}","")),callback:new Service("/rtm/rest/aggregate/refresh","Post",'{"streamedSessionId": "__streamedSessionId__"}',new Preproc("function(requestFragment, workData){var newRequestFragment = requestFragment;for(i=0;i<workData.length;i++){newRequestFragment = newRequestFragment.replace(workData[i].placeholder, workData[i].value);}return newRequestFragment;}"),new Postproc("function(response){return response.data.payload.stream.complete;}",c,[{key:"metric",value:"avg",isDynamic:!1}],{},""))},a.controls.rtmmodel=new DefaultRTMPayload,a}function RTMAggregatesSlaveQuery(){var a=new DefaultAsyncQuery;a.controls=new DefaultControls,a.paged=new DefaultPaging,a.controltype="RTM",a.controls.querytype="aggregates";var b=function(a,b){var c=(b.metric,b.metric.split(";")),d=[],e=a.data.payload.stream.streamData,f=Object.keys(e);return $.each(f,function(a,b){var f=Object.keys(e[b]);$.each(f,function(a,f){$.each(c,function(a,c){c&&e[b][f][c]&&d.push({x:b,y:e[b][f][c],z:f,m:c})})})}),d},c=b.toString();return a.type="Async",a.datasource={service:new Service("/rtm/rest/aggregate/get","Post","",new Preproc("function(requestFragment, workData){var newRequestFragment = requestFragment;for(i=0;i<workData.length;i++){newRequestFragment = newRequestFragment.replace(workData[i].key, workData[i].value);}return newRequestFragment;}"),new Postproc("","",[],"function(response){if(!response.data.payload){console.log('No payload ->' + JSON.stringify(response)); return null;}return [{ placeholder : '__streamedSessionId__', value : response.data.payload.streamedSessionId, isDynamic : false }];}","")),callback:new Service("/rtm/rest/aggregate/refresh","Post",'{"streamedSessionId": "__streamedSessionId__"}',new Preproc("function(requestFragment, workData){var newRequestFragment = requestFragment;for(i=0;i<workData.length;i++){newRequestFragment = newRequestFragment.replace(workData[i].placeholder, workData[i].value);}return newRequestFragment;}"),new Postproc("function(response){return response.data.payload.stream.complete;}",c,[{key:"metric",value:"avg",isDynamic:!1}],{},""))},a.controls.rtmmodel=new DefaultRTMPayload,a}function RTMRawValuesBaseQuery(){return new SimpleQuery("Raw",new Service("/rtm/rest/measurement/find","Post","",new Preproc("function(requestFragment, workData){var newRequestFragment = requestFragment;for(i=0;i<workData.length;i++){newRequestFragment = newRequestFragment.replace(workData[i].key, workData[i].value);}return newRequestFragment;}"),new Postproc("","",[],{},"")))}function RTMRawValuesMasterQuery(){var a=function(a,b){var c=[],d=a.data.payload;return $.each(d,function(a,b){c.push({x:b.begin,y:b.value,z:b.name})}),c},b=new RTMRawValuesBaseQuery;b.datasource.service.postproc.transform["function"]=a.toString();var c="begin",d="value";b.datasource.service.postproc.transform.args=[{key:"timeField",value:c,isDynamic:!1},{key:"valueField",value:d,isDynamic:!1}];var e=new TemplatedQuery("Plain",b,new Paging("On",new Offset("__FACTOR__","return 0;","return value + 1;","if(value > 0){return value - 1;} else{return 0;}"),null),new Controls(new DefaultTemplate,"",[new Placeholder("__FACTOR__","100",!1)]));return e.controltype="RTM",e.controls.querytype="rawvalues",e.controls.rtmmodel=new DefaultRTMPayload,e}function RTMRawValuesSlaveQuery(){var a=function(a,b){var c=a.data.payload,d=b.metric.split(";"),e=[],f=[],g={};return f.push("begin"),f.push("name"),$.each(d,function(a,b){f.push(b)}),$.each(c,function(a,b){var c=[];c.push(b.begin),c.push(b.name),$.each(d,function(a,d){d&&(b[d]||0===b[d])?c.push(b[d]):c.push("")}),e.push(c)}),g.headers=f,g.data=e,g},b=new RTMRawValuesBaseQuery;b.datasource.service.postproc.transform["function"]=a.toString(),b.datasource.service.postproc.transform.args=[{key:"metric",value:"avg",isDynamic:!1}];var c=new TemplatedQuery("Plain",b,new RTMRawValuesBaseQuery("begin","value","name"),new DefaultPaging,new Controls(new DefaultTemplate,"",[new Placeholder("__FACTOR__","100",!1)]));return c.controltype="RTM",c.controls.querytype="rawvalues",c.controls.rtmmodel=new DefaultRTMPayload,c}function RTMMasterState(){return new DashletState("Chart",!0,0,new DashletData(null,null,null),new DefaultChartOptions,new Config("Fire","Off",!0,!1,"unnecessaryAsMaster"),new RTMAggregatesMasterQuery,new DefaultGuiClosed,new DefaultInfo)}function RTMSlaveState(a){var b=new Config("Fire","Off",!1,!0,"state.data.rawresponse",null,null,null,null,"On");return b.currentmaster={oid:a,title:"Chart"},new DashletState("Table",!0,0,new DefaultDashletData,new ChartOptions("dualTable",!1,!1,'function (d) {\r\n    var value;\r\n    if ((typeof d) === "string") {\r\n        value = parseInt(d);\r\n    } else {\r\n        value = d;\r\n    }\r\n\r\n    return d3.time.format("%Y.%m.%d %H:%M:%S")(new Date(value));\r\n}',"function (d) { return d.toFixed(1); }",null,null,null,"xz",!0),b,new RTMAggregatesSlaveQuery,new DefaultGuiClosed,new DefaultInfo)}function RTMMasterWidget(a){return new Widget(a,new DefaultWidgetState,new RTMMasterState)}function RTMSlaveWidget(a){return new Widget("RTM-Slave-"+getUniqueId(),new DefaultWidgetState,new RTMSlaveState(a))}function RTMDashboardState(){var a="RTM-Master-"+getUniqueId();return new DashboardState(new DefaultGlobalSettings,[new RTMMasterWidget(a),new RTMSlaveWidget(a)],"RTM Dashboard","aggregated",new DefaultDashboardGui)}function RTMDashboard(){return new Dashboard(getUniqueId(),new RTMDashboardState,"rtm")}function RTMserialize(a){var b=RTMdeepCopy(a);return angular.toJson(b)}function RTMdeepCopy(a){if(!a)throw new Error("guiPayload is null or undefined");var b=JSON.parse(angular.toJson(a));return $.each(b.selectors1,function(a,c){var d=[];$.each(c.numericalFilters,function(a,b){"date"===b.type?d.push(new NumericalFilter(b.key,Date.parse(b.minDate),Date.parse(b.maxDate))):d.push(b)}),b.selectors1[a].numericalFilters=d}),$.each(b.selectors1,function(a,b){$.each(b.textFilters,function(a,b){b.type=void 0,"On"===b.regex?b.regex=!0:b.regex=!1}),$.each(b.numericalFilters,function(a,b){b.type=void 0})}),b}function AjaxClient(a,b,c,d,e){return{url:a,data:b,method:c,success:d,error:e,execute:function(){$.ajax("http://127.0.0.1:8080/").done(function(a){d(a)}).fail(function(a){e(a)})}}}function ComsClient(){return{url:"TODO"}}function IdIndexArray(a){if(!a)throw new Error("Please provide array ref as argument.");return{array:a,getId:function(a){return a.oid},addNewWithId:function(a,b){return a.oid=b,this.array.push(a),b},addNew:function(a){var b=getUniqueId();return a.oid=b,this.array.push(a),b},addExisting:function(a){this.array.push(a)},clear:function(){this.array.length=0},getById:function(a){var b=this.getIndexById(a);return-1===b?-1:this.array[b]},hasById:function(a){return-1!==this.getById(a)?!0:!1},getByIndex:function(a){return this.array[a]},getIndexById:function(a){for(i=0;i<this.array.length;i++)if(this.array[i].oid===a)return i;return-1},getIdByIndex:function(a){return this.array[a].oid},removeById:function(a){this.array.splice(this.getIndexById(a),1)},removeByIndex:function(a){this.getIdByIndex(a);this.array.splice(a,1)},copyById:function(a){var b=jsoncopy(this.getById(a));return b.oid=getUniqueId(),b},duplicateById:function(a){var b=this.addExisting(this.copyById(a)),c=this.getIndexById(b),d=this.getIndexById(a);this.moveFromToIndex(c,d+1)},moveFromToIndex:function(a,b){this.array.splice(b,0,this.array.splice(a,1)[0])},count:function(){return this.array.length},getPrevious:function(a){return this.getByIndex(this.getIndexById(a)-1)},getPreviousId:function(a){return this.getId(this.getPrevious(a))},getNext:function(a){return this.getByIndex(this.getIndexById(a)+1)},getNextId:function(a){return this.getId(this.getNext(a))},addIfAbsent:function(a){if(!a.oid)return this.addNew(a);var b=this.getIndexById(a.oid);return 0>b?this.addExisting(a):b},removeIfExists:function(a){if(!a)throw"Cant remove object without proper oid";var b=this.getIndexById(a);return 0>b?-1:this.removeByIndex(b)},removeAll:function(){for(var a=0;a<this.array.length;a++)this.removeByIndex(a)},getAsArray:function(){return this.array}}}function Processor(a,b){return{getServices:function(){return srvDescriptors}}}function ServiceDescriptor(){var a=services;return{getServices:function(){return a}}}function ServiceChain(a){var b=a;return{getServices:function(){return b}}}function Transformation(a,b){var c=a,d=b.toString();return{getName:function(){return c},getFunctionAsString:function(){return d}}}var productionmode=!0,productionFile="viz.js",devJSFolder="/js/",devTemplateFolder="/templates/",vizScripts={},registerScript=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src,c=b.split("/"),d=c[c.length-1];vizScripts[d]=b},forceRedraw=function(a){var b=a.$root.$$phase;"$apply"==b||"$digest"==b?a.$eval(function(){self.value=0}):a.$apply(function(){self.value=0})},resolveTemplateURL=function(a,b){return productionmode===!1?templateUrl=vizScripts[a].replace(devJSFolder,devTemplateFolder).replace(a,b)+"?who="+b+"&anticache="+getUniqueId():templateUrl=vizScripts[productionFile].replace(productionFile,"templates/"+b),templateUrl},setIntervalDefault=3e3,setIntervalAsyncDefault=500,keyvalarrayToIndex=function(a,b,c){var d={};return $.each(a,function(a,e){d[e[b]]=e[c]}),d},stringToColour=function(a){return a?intToColour(hashCode(a.toString())):"rgb(0,0,0)"},hashCode=function(a){var b,c,d=0;if(0===a.length)return d;for(b=0;b<a.length;b++)c=a.charCodeAt(b),d=(d<<5)-d+c,d|=0;return d},intToColour=function(a){var b=5e5*(a+1);a%2==0&&(b=100*b),b>>>=0;var c=255&b,d=(65280&b)>>>8,e=(16711680&b)>>>16;return"rgb("+[e,d,c].join(",")+")"},runResponseProc=function(postProc,args,response){return eval("("+postProc+")(response, args)")},runRequestProc=function(postProc,requestFragment,workData){return eval("("+postProc+")(requestFragment, workData)")},runValueFunction=function(functionFragment,value){return eval("(function(value){"+functionFragment+"})(value)")},runDynamicEval=function(expression){return eval(expression)},evalDynamic=function(a){var b=JSON.parse(JSON.stringify(a));return $.each(b,function(a,b){b.isDynamic&&(b.value=runDynamicEval(b.value))}),b},resolve=function(a,b){b=b.split(".");for(var c=a;b.length;){if("object"!=typeof c)return void 0;c=c[b.shift()]}return c},getUniqueId=function(){return Math.random().toString(36).substr(2,9)},jsoncopy=function(a){return JSON.parse(angular.toJson(a))},formatPotentialTimestamp=function(a){var b;return b="string"==typeof a?parseInt(a):a,b>=1e9&&2e9>b&&(b=1e3*b),b>=1e12&&2e12>b?d3.time.format("%Y.%m.%d %H:%M:%S")(new Date(b)):a};String.prototype.endsWith||(String.prototype.endsWith=function(a,b){return(void 0===b||b>this.length)&&(b=this.length),this.substring(b-a.length,b)===a}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(a,b){var c=b>0?0|b:0;return this.substring(c,c+a.length)===a}}),String.prototype.includes||(String.prototype.includes=function(a,b){"use strict";if(a instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===b&&(b=0),-1!==this.indexOf(a,b)}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,b){function c(a,b){return a===b||"number"==typeof a&&"number"==typeof b&&isNaN(a)&&isNaN(b)}if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return!1;for(var f=0|b,g=Math.max(f>=0?f:e-Math.abs(f),0);e>g;){if(c(d[g],a))return!0;g++}return!1}});var AbstractIdentifiableObjectMethods={getId:function(){return this._id},setId:function(a){this._id=a},getCustomFields:function(){return this.customFields},setCustomFields:function(a){this.customFields=a},addCustomFields:function(a,b){this.customFields.key=b}};jQuery.extend(AbstractIdentifiableObject.prototype,AbstractIdentifiableObjectMethods);var AbstractOrganizableObjectMethods={getAttributes:function(){return this.attributes},setAttributes:function(a){this.attributes=a}};AbstractOrganizableObject.prototype=new AbstractIdentifiableObject,AbstractOrganizableObject.prototype.constructor=AbstractOrganizableObject,jQuery.extend(AbstractOrganizableObject.prototype,AbstractOrganizableObjectMethods),registerScript(),angular.module("rtm-controls",["angularjs-dropdown-multiselect"]).directive("rtmControls",function(){var a="rtm-controls.js",b=resolveTemplateURL(a,"rtm-controls-horizontal.html"),c=resolveTemplateURL(a,"rtm-controls-vertical.html");return{restrict:"E",scope:{payload:"=",query:"=",orientation:"=?",slavestate:"=",masterstate:"=",inputsettingscol:"=",initcomplete:"="},template:'<div ng-include="resolveDynamicTemplate()"></div>',controller:function(a){a.unwatchers=[],a.forceReloadQuery=function(){forceRedraw(a),setTimeout(function(){a.$emit("broadcastQueryFire")},100)},a.forceReloadTransform=function(){a.masterstate&&a.initcomplete&&(a.masterstate.data.rawresponse=JSON.parse(angular.toJson(a.masterstate.data.rawresponse)))},a.$on("forceReloadTransform",function(b,c){a.forceReloadTransform()}),a.$on("forceReloadQuery",function(b,c){a.forceReloadQuery()}),a.resolveDynamicTemplate=function(){return"horizontal"===a.orientation?b:c},a.init=function(){a.masterstate&&(a.unwatchers.push(a.$watch("masterstate.query.controls.querytype",function(b,c){var d=a.masterstate.query.controls.rtmmodel,e=a.masterstate.query.controls.template.templatedPayload;a.masterstate.query&&a.masterstate.query.controls&&a.masterstate.query.controls.querytype&&c!==b&&("aggregates"===b?(a.masterstate.query=new RTMAggregatesMasterQuery,a.slavestate.query=new RTMAggregatesSlaveQuery,a.slavestate.options.chart.type="dualTable",a.slavestate.options.chart.dualtranspose=!0,a.slavestate.options.chart.dualzx="xz"):"rawvalues"===b?(a.masterstate.query=new RTMRawValuesMasterQuery,a.slavestate.query=new RTMRawValuesSlaveQuery,a.slavestate.options.chart.type="table",a.slavestate.options.chart.dualtranspose=!0,a.slavestate.options.chart.dualzx="xz"):console.log("unsupported RTM service: "+b),d&&(a.masterstate.query.controls.rtmmodel=d),e&&(a.masterstate.query.controls.template.templatedPayload=e),a.forceReloadQuery())})),a.unwatchers.push(a.$watch("masterstate.query.controls.rtmmodel",function(b,c){var d=RTMserialize(b);d&&(a.masterstate.query.controls.template.templatedPayload=d)},!0)),a.inputsettingscol&&a.inputsettingscol.length>0&&$.each(a.inputsettingscol,function(b,c){var d=c.value.split(","),e=d[0],f=d[1],g=d[2],h=d[3];"text"===e&&a.payload.selectors1[0].textFilters.push(new TextFilter(f,g,h))}))},a.addSelector=function(){a.payload.selectors1.push(new DefaultSelector)},a.clearAll=function(){a.payload.selectors1.length=0},a.removeSelector=function(b){a.payload.selectors1.splice(b,1)},a.exportRaw=function(b){var c=RTMdeepCopy(a.masterstate.query.controls.rtmmodel);c.serviceParams["measurementService.nextFactor"]="0",c.serviceParams["measurementService.outputFormat"]=b;var d=document.createElement("form");d.setAttribute("method","post"),d.setAttribute("action","/rtm/rest/measurement/export"),d.setAttribute("target","export");var e=document.createElement("input");e.type="hidden",e.name="value",e.value=angular.toJson(c),d.appendChild(e),document.body.appendChild(d),d.submit(),document.body.removeChild(d)},a.init()}}}).directive("rtmSelector",function(){return{restrict:"E",scope:{textfilters:"=",numericalfilters:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-selector.html"),controller:function(a){a.addTextFilter=function(){a.textfilters.push(new DefaultTextFilter)},a.addNumericalFilter=function(){a.numericalfilters.push(new DefaultNumericalFilter)},a.addDateFilter=function(){a.numericalfilters.push(new DefaultDateFilter)},a.removeTextfilter=function(b){a.textfilters.splice(b,1)},a.removeNumericalfilter=function(b){a.numericalfilters.splice(b,1)}}}}).directive("rtmServiceParams",function(){return{restrict:"E",scope:{params:"=",query:"=",masterstate:"=",slavestate:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-service-params.html"),controller:function(a){a.initComplete=!1,a.setParam=function(b,c){a.params[b]=c,a.forceReloadQuery()},a.setValue=function(b,c){a[b]=c},a.csvExport=function(){var b=a.slavestate.gui.tabledata;if(!a.slavestate.options.chart.dualtranspose){var c=b.headers[0];b.headers[0]=b.headers[1],b.headers[1]=c}if(downloadCSV(a.slavestate.gui.tabledata),!a.slavestate.options.chart.dualtranspose){var c=b.headers[0];b.headers[0]=b.headers[1],b.headers[1]=c}},a.setDualTranspose=function(b){a.slavestate.options.chart.dualtranspose=b},a.updateChartMetric=function(b,c){a.masterstate&&a.masterstate.query&&a.masterstate.query.datasource&&a.masterstate.query.datasource[b]&&a.masterstate.query.datasource[b].postproc&&a.masterstate.query.datasource[b].postproc.transform&&a.masterstate.query.datasource[b].postproc.transform.args&&a.masterstate.query.datasource[b].postproc.transform.args[0]&&a.masterstate.query.datasource[b].postproc.transform.args[0].value&&(a.masterstate.query.datasource[b].postproc.transform.args[0].value=c)},a.forceReloadQuery=function(){a.$emit("forceReloadQuery")},a.forceReloadTransform=function(){a.$emit("forceReloadTransform")},a.updateTableMetrics=function(b,c){c&&c.length>0&&a.slavestate&&a.slavestate.query&&a.slavestate.query.datasource&&a.slavestate.query.datasource[b]&&a.slavestate.query.datasource[b].postproc&&a.slavestate.query.datasource[b].postproc.transform&&a.slavestate.query.datasource[b].postproc.transform.args&&a.slavestate.query.datasource[b].postproc.transform.args[0]&&a.slavestate.query.datasource[b].postproc.transform.args[0].value&&(a.slavestate.query.datasource[b].postproc.transform.args[0].value=c)},a.$watch("query.controls.querytype",function(b){a.masterstate&&("rawvalues"===b?a.masterstate.options.chart.type="scatterChart":a.masterstate.options.chart.type="lineChart")}),a.asList=function(a){var b="";return $.each(a,function(a,c){c&&(b+=c.id+";")}),b},a.performTableMetricUpdate=function(b){a.updateTableMetrics("callback",a.asList(a.selectedAggMetrics)),a.updateTableMetrics("service",a.asList(a.selectedRawMetrics)),b&&a.forceReloadTransform()},a.performChartMetricUpdate=function(b){a.updateChartMetric("callback",a.selectedChartAggMetric),a.updateChartMetric("service",a.selectedChartRawMetric),b&&a.forceReloadTransform()},a.$watchCollection("selectedAggMetrics",function(b){a.performTableMetricUpdate(!0)}),a.$watchCollection("selectedRawMetrics",function(b){a.performTableMetricUpdate(!0)}),a.$watch("selectedChartAggMetric",function(b){a.performChartMetricUpdate(!0)}),a.$watch("selectedChartRawMetric",function(b){a.performChartMetricUpdate(!0)}),a.$watch("slavestate.options.chart.dualzx",function(b){a.forceReloadTransform()}),a.getMetricsList=function(a){var b=[],c=[];return _.each(a,function(a){for(var c in a)b.indexOf(c)<0&&b.push(c)}),_.each(b,function(a){c.push({label:a,id:a})}),c},a.$watch("masterstate.data.rawresponse",function(b){a.query&&("rawvalues"===a.query.controls.querytype&&b&&b.dashdata&&b.dashdata.data&&b.dashdata.data.payload&&(a.rawmetrics=a.getMetricsList(b.dashdata.data.payload)),a.performTableMetricUpdate(!1),a.performChartMetricUpdate(!1))}),a.aggregatemetrics=[{label:"count",id:"cnt"},{label:"average",id:"avg"},{label:"min",id:"min"},{label:"max",id:"max"},{label:"median",id:"50th pcl"},{label:"count / sec",id:"tps"},{label:"count / min",id:"tpm"},{label:"80th pcl",id:"80th pcl"},{label:"90th pcl",id:"90th pcl"},{label:"99th pcl",id:"99th pcl"},{label:"pcl precision",id:"pcl precision"}],a.rawmetrics=[{label:"value",id:"value"},{label:"rnStatus",id:"rnStatus"}],a.selectedAggMetrics=jsoncopy(a.aggregatemetrics),a.selectedRawMetrics=jsoncopy(a.rawmetrics),a.selectedChartAggMetric="avg",a.selectedChartRawMetric="value",a.metricSearchSettings={scrollableHeight:"200px",scrollable:!0,enableSearch:!0},a.tabIndex=[0,0,0],a.selectTab=function(b,c){if(b>0)for(;a.tabIndex.length<b;)a.tabIndex.push(0);a.tabIndex[b]=c},a.isTabActive=function(b,c){return a.tabIndex.length>b&&a.tabIndex[b]==c?!0:!1}}}}).directive("rtmTextFilter",function(){return{restrict:"E",scope:{key:"=",value:"=",regex:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-text-filter.html"),controller:function(a){a.setKey=function(b){a.key=b}}}}).directive("rtmNumericalFilter",function(){return{restrict:"E",scope:{key:"=",minvalue:"=",maxvalue:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-numerical-filter.html"),controller:function(a){a.setKey=function(b){a.key=b}}}}).directive("rtmDateFilter",function(){return{restrict:"E",scope:{key:"=",mindate:"=",maxdate:"="},templateUrl:resolveTemplateURL("rtm-controls.js","rtm-date-filter.html"),controller:function(a){a.setKey=function(b){a.key=b}}}}),registerScript(),angular.module("angularjs-dropdown-multiselect",[]).directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(a,b,c,d){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@"},template:function(a,b){var c=b.checkboxes?!0:!1,d=b.groupBy?!0:!1,e='<div class="multiselect-parent btn-group dropdown-multiselect rtm-dropdown form-radio dropdown">';e+='<button type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<span class="caret"></span></button>',e+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto' }\" style=\"overflow: scroll\" >",e+='<li ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll()"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>',e+='<li ng-show="settings.showUncheckAll"><a data-ng-click="deselectAll();"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>',
e+='<li ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll" class="divider"></li>',e+='<li ng-show="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control" style="width: 100%;" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',e+='<li ng-show="settings.enableSearch" class="divider"></li>',d?(e+='<li ng-repeat-start="option in orderedItems | filter: searchFilter" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>',e+='<li ng-repeat-end role="presentation">'):e+='<li role="presentation" ng-repeat="option in options | filter: searchFilter">',e+='<a role="menuitem" tabindex="-1" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))">',e+=c?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a>':"<span data-ng-class=\"{'glyphicon glyphicon-ok': isChecked(getPropertyForObject(option,settings.idProp))}\"></span> {{getPropertyForObject(option, settings.displayProp)}}</a>",e+="</li>",e+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',e+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',e+="</ul>",e+="</div>",a.html(e)},link:function(c,d,e){function f(a){var b={};return""===c.settings.externalIdProp?b[c.settings.idProp]=a:b[c.settings.externalIdProp]=a,b}function g(a){for(var b in a)delete a[b]}var h=d.children()[0];c.toggleDropdown=function(){c.open=!c.open},c.checkboxClick=function(a,b){c.setSelectedItem(b),a.stopImmediatePropagation()},c.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop},c.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,closeOnSelect:!1,buttonClasses:"btn btn-primary viz-btn-success dropdown-toggle",closeOnDeselect:!1,groupBy:e.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop},c.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked"},c.searchFilter=c.searchFilter||"",angular.isDefined(c.settings.groupBy)&&c.$watch("options",function(b){angular.isDefined(b)&&(c.orderedItems=a("orderBy")(b,c.settings.groupBy))}),angular.extend(c.settings,c.extraSettings||[]),angular.extend(c.externalEvents,c.events||[]),angular.extend(c.texts,c.translationTexts),c.singleSelection=1===c.settings.selectionLimit,c.singleSelection&&angular.isArray(c.selectedModel)&&0===c.selectedModel.length&&g(c.selectedModel),c.settings.closeOnBlur&&b.on("click",function(a){for(var b=a.target.parentElement,d=!1;angular.isDefined(b)&&null!==b&&!d;)_.contains(b.className.split(" "),"multiselect-parent")&&!d&&b===h&&(d=!0),b=b.parentElement;d||c.$apply(function(){c.open=!1})}),c.getGroupTitle=function(a){return null!==c.settings.groupByTextProvider?c.settings.groupByTextProvider(a):a},c.getButtonText=function(){if(c.settings.dynamicTitle&&(c.selectedModel.length>0||angular.isObject(c.selectedModel)&&_.keys(c.selectedModel).length>0)){if(c.settings.smartButtonMaxItems>0){var a=[];return angular.forEach(c.options,function(b){if(c.isChecked(c.getPropertyForObject(b,c.settings.idProp))){var d=c.getPropertyForObject(b,c.settings.displayProp),e=c.settings.smartButtonTextConverter(d,b);a.push(e?e:d)}}),c.selectedModel.length>c.settings.smartButtonMaxItems&&(a=a.slice(0,c.settings.smartButtonMaxItems),a.push("...")),a.join(", ")}var b;return b=c.singleSelection?null!==c.selectedModel&&angular.isDefined(c.selectedModel[c.settings.idProp])?1:0:angular.isDefined(c.selectedModel)?c.selectedModel.length:0,0===b?c.texts.buttonDefaultText:b+" "+c.texts.dynamicButtonTextSuffix}return c.texts.buttonDefaultText},c.getPropertyForObject=function(a,b){return angular.isDefined(a)&&a.hasOwnProperty(b)?a[b]:""},c.selectAll=function(){c.deselectAll(!1),c.externalEvents.onSelectAll(),angular.forEach(c.options,function(a){c.setSelectedItem(a[c.settings.idProp],!0)})},c.deselectAll=function(a){a=a||!0,a&&c.externalEvents.onDeselectAll(),c.singleSelection?g(c.selectedModel):c.selectedModel.splice(0,c.selectedModel.length)},c.setSelectedItem=function(a,b){var d=f(a),e=null;if(e=""===c.settings.externalIdProp?_.find(c.options,d):d,c.singleSelection)return g(c.selectedModel),angular.extend(c.selectedModel,e),c.externalEvents.onItemSelect(e),void(c.settings.closeOnSelect&&(c.open=!1));b=b||!1;var h=-1!==_.findIndex(c.selectedModel,d);!b&&h?(c.selectedModel.splice(_.findIndex(c.selectedModel,d),1),c.externalEvents.onItemDeselect(d)):!h&&(0===c.settings.selectionLimit||c.selectedModel.length<c.settings.selectionLimit)&&(c.selectedModel.push(e),c.externalEvents.onItemSelect(e)),c.settings.closeOnSelect&&(c.open=!1)},c.isChecked=function(a){return c.singleSelection?null!==c.selectedModel&&angular.isDefined(c.selectedModel[c.settings.idProp])&&c.selectedModel[c.settings.idProp]===f(a)[c.settings.idProp]:-1!==_.findIndex(c.selectedModel,f(a))},c.externalEvents.onInitDone()}}}]),registerScript(),angular.module("dashletcomssrv",[]).service("dashletcomssrv",function(a){var b={};return b.buffer={},b.masters={},b.masters.array=[],b.masters=new IdIndexArray(b.masters.array,function(a){}),b.registerWidget=function(a,c){b.masters.addIfAbsent({oid:a,title:c})},b.udpdateTitle=function(a,c){b.masters.getById(a).title=c},b.unregisterWidget=function(a){b.masters.removeIfExists(a)},b.updateMasterValue=function(a,c){b.buffer[a]=c},b}),registerScript(),angular.module("explore",["viz-dashlet"]).directive("explore",function(){return{restrict:"E",scope:{},templateUrl:resolveTemplateURL("explore.js","explore.html"),controller:function(a){a.state=new ExplorationDashletState,a.presets=new StaticPresets,a.resize=function(){a.state.options.chart.height=window.innerHeight/3},$(window).on("resize",function(){a.resize(),a.$apply(function(){self.value=0})}),a.resize()}}}),registerScript(),angular.module("key-val-collection",["ui.bootstrap"]).directive("keyValCollection",function(){return{restrict:"E",scope:{collection:"=",collectionname:"="},templateUrl:resolveTemplateURL("key-val-collection.js","key-val-collection.html"),controller:function(a){a.getNumber=function(a){return new Array(a)},a.addElement=function(){a.collection.push({key:"__?__",value:"?",isDynamic:!1}),a.changed()},a.removeElement=function(b){a.collection.splice(b,1),a.changed()},a.changed=function(){a.$emit("key-val-collection-change-"+a.collectionname,{collection:a.collection})}}}}),registerScript(),angular.module("rtm",["viz-dashboard-manager"]).directive("rtm",function(){return{restrict:"E",scope:{},templateUrl:resolveTemplateURL("rtm.js","rtm.html"),controller:function(a){a.staticPresetsInstance=new StaticPresets,a.dashboardsendpoint=[new RTMDashboard]}}}),registerScript(),angular.module("viz-dashboard-manager",["viz-dashboard","ui.bootstrap","dashletcomssrv"]).directive("vizDashboardManager",function(){return{restrict:"E",scope:{presets:"=",dashboards:"=",displaymode:"=",headermargin:"=",restprefix:"="},templateUrl:resolveTemplateURL("viz-dashboard.js","viz-dashboard-manager.html"),controller:function(a,b){a.headermargin?a.topmargin=a.headermargin:a.topmargin=b[0].getBoundingClientRect().top,a.init=!1,a.selectTab=function(b){a.mgrtabstate=b,a.refreshWidgets()},a.isTabActive=function(b){return b===a.mgrtabstate},a.removeDashboard=function(b){a.mgrtabstate===b&&(a.dwrap.getIndexById(a.mgrtabstate)>0?a.mgrtabstate=a.dwrap.getPreviousId(a.mgrtabstate):a.dwrap.getIndexById(a.mgrtabstate)<a.dwrap.count()-1?a.mgrtabstate=a.dwrap.getNextId(a.mgrtabstate):a.mgrtabstate=null),a.dwrap.removeById(b),a.refreshWidgets()},a.$on("dashboard-new",function(b,c){var d;d=c&&c.displaytype&&"exploded"===c.displaytype?a.dwrap.addNew(new DefaultExplorationDashboard):a.dwrap.addNew(new DefaultDashboard),a.mgrtabstate=d}),a.$on("dashboard-clear",function(){a.dwrap.clear()}),a.$on("dashboard-current-addWidget",function(){var b=a.dwrap.getById(a.mgrtabstate),c=new IdIndexArray(b.dstate.widgets);c.addNew(new DefaultWidget)}),a.$on("dashboard-current-clearWidgets",function(){var b=a.dwrap.getById(a.mgrtabstate),c=new IdIndexArray(b.dstate.widgets);c.clear()}),a.$on("dashletinput-initialized",function(){a.init||(a.init=!0,a.$emit("manager-fully-loaded"))}),a.$on("dashlet-copy",function(b,c){a.clipboard=c}),a.$on("dashlet-paste",function(b){if(a.clipboard){var c=new Widget(getUniqueId(),new DefaultWidgetState,jsoncopy(a.clipboard.state)),d=a.dwrap.getById(a.mgrtabstate),e=new IdIndexArray(d.dstate.widgets);e.addNew(c)}}),a.onstartup=function(){a.dwrap=new IdIndexArray(a.dashboards),a.dashboards.length>0&&a.dashboards[0]&&a.dashboards[0].oid&&(a.mgrtabstate=a.dashboards[0].oid),a.$emit("manager-ready")},a.onstartup(),a.$watchCollection("dashboards",function(b,c){a.onstartup();var d=a.dashboards.length-1;d>=0&&a.dashboards[d]&&a.selectTab(a.dashboards[d].oid),a.refreshWidgets()}),a.$watch("displaymode",function(b){a.refreshWidgets()}),a.refreshWidgets=function(){$(document).ready(function(){a.$broadcast("resize-widget")})}}}}),registerScript(),angular.module("viz-dashboard",["viz-mgd-widget","ui.bootstrap","dashletcomssrv"]).directive("vizDashboard",function(){var a="viz-dashboard.js",b=resolveTemplateURL(a,"viz-rtm-dashboard.html"),c=resolveTemplateURL(a,"viz-dashboard.html");resolveTemplateURL(a,"error-template.html");return{restrict:"E",scope:{dashboardid:"=",dstate:"=",displaymode:"=",displaytype:"=",presets:"=",topmargin:"=",restprefix:"=",templatetype:"=?"},template:'<div ng-include="resolveDynamicTemplate()"></div>',controller:function(a,d){a.initcomplete=!1,a.resolveDynamicTemplate=function(){return"rtm"===a.templatetype?b:c},"rtm"===a.templatetype&&(a.masterWidget=a.dstate.widgets[0],a.slaveWidget=a.dstate.widgets[1]),a.$on("broadcastQueryFire",function(b,c){a.broadcastQueryFire()}),a.broadcastQueryFire=function(){a.$broadcast("fireQueryDependingOnContext")},a.toggleAutorefresh=function(b){"undefined"==typeof b?a.dstate.globalsettings.autorefresh=!a.dstate.globalsettings.autorefresh:a.dstate.globalsettings.autorefresh=b,a.$broadcast("globalsettings-refreshToggle",{"new":a.dstate.globalsettings.autorefresh})},a.toggleChevron=function(){a.dstate.globalsettings.chevron=!a.dstate.globalsettings.chevron},a.$on("mgdwidget-remove",function(b,c){a.wwrap.removeById(c.wid)}),a.$on("mgdwidget-moveLeft",function(b,c){var d=a.wwrap.getIndexById(c.wid);d>0&&a.wwrap.moveFromToIndex(d,d-1)}),a.$on("mgdwidget-moveRight",function(b,c){var d=a.wwrap.getIndexById(c.wid);d<a.wwrap.count()-1&&a.wwrap.moveFromToIndex(d,d+1)}),a.$on("mgdwidget-duplicate",function(b,c){a.wwrap.duplicateById(c.wid)}),a.$on("clearwidgets",function(b,c){a.dashboardid===c.dashboardid&&a.wwrap.clear()}),a.$on("addwidget",function(b,c){a.dashboardid===c.dashboardid&&a.addWidget(c)}),a.$on("apply-global-setting",function(b,c){var d=!1;$.each(a.dstate.globalsettings.placeholders,function(b,e){e.key===c.key&&(a.dstate.globalsettings.placeholders[b].value=c.value,a.dstate.globalsettings.placeholders[b].isDynamic=c.isDynamic,d=!0)}),d||a.dstate.globalsettings.placeholders.push(new Placeholder(c.key,c.value,c.isDynamic)),$(document).ready(function(){a.$broadcast("fireQueryDependingOnContext")})}),a.$on("globalsettings-globalRefreshToggle",function(b,c){c&&"undefined"!=typeof c["new"]?a.toggleAutorefresh(c["new"]):a.toggleAutorefresh()}),a.addWidget=function(b){var c;b||(c=new DefaultWidget);a.wwrap.addNew(c)},$(window).on("resize",function(){a.$broadcast("resize-widget")}),a.onstartup=function(){a.wwrap=new IdIndexArray(a.dstate.widgets),a.gsautorefreshInterval=null,a.initAuto=!1,a.$on("dashletinput-ready",function(){a.initAuto||(a.initAuto=!0,a.dstate.globalsettings.autorefresh&&(a.dstate.globalsettings.autorefresh=!1,a.toggleAutorefresh()),a.$emit("dashboard-ready"),a.initcomplete=!0)})},a.onstartup(),a.$watchCollection("dstate.widgets",function(b){a.onstartup()})}}}),registerScript(),angular.module("viz-dashlet",["viz-query","dashletcomssrv"]).directive("vizDashlet",function(){var a="viz-dashlet.js",b=resolveTemplateURL(a,"viz-dashlet-aggregated.html"),c=resolveTemplateURL(a,"viz-dashlet-exploded.html"),d=resolveTemplateURL(a,"error-template.html");return{restrict:"E",scope:{widgetid:"=",state:"=",displaytype:"=",displaymode:"=",presets:"=",restprefix:"=",inputsettingscol:"="},template:'<div ng-include="resolveDynamicTemplate()"></div>',controller:function(a,e,f,g){a.state&&(a.state.unwatchers=[]),a.loaded=!1,a.resolveDynamicTemplate=function(){return"aggregated"===a.displaytype?b:"exploded"===a.displaytype?c:d},a.selectTab=function(b){a.state.tabindex=b},a.isTabActive=function(b){return b===a.state.tabindex},a.messageBoxClick=function(){a.toggleBarchevronToConf(),a.selectTab(3),a.state.gui.status.open.info=!0},a.toggleBarchevronToConf=function(){a.state.viewtoggle=!a.state.viewtoggle},a.toggleBarchevronToViz=function(){"Fire"===a.state.config.toggleaction&&a.fireQueryDependingOnContext(),"Draw"===a.state.config.toggleaction&&(a.state.data.rawresponse=jsoncopy(a.state.data.rawresponse)),"None"===a.state.config.toggleaction&&console.log("toggle view action is set to none: doing nothing."),a.state.viewtoggle=!a.state.viewtoggle},a.fireQueryDependingOnContext=function(){if(a.state.config.slave||"On"===a.state.config.autorefresh){if(a.state.data.rawresponse){var b=JSON.parse(angular.toJson(a.state.data.rawresponse));a.state.data.rawresponse=b}}else a.fireQuery()},a.cleanupState=function(){a.state.info.http.asynccheckpoint=!1,a.clearAsync(),a.$broadcast("cleanup-info"),a.isRawDisplay="On"===a.state.info.showraw},a.isOngoingQuery=!1,a.autorefreshInterval=void 0,a.fireQuery=function(){if(!a.isOngoingQuery&&(a.cleanupState(),a.state.query&&a.state.query.controls))try{a.isOngoingQuery=!0;var b=a.state.query.datasource.service;b.params||(b.params=""),a.isRawDisplay&&(a.state.info.http.servicesent="url :"+JSON.stringify(b.url+b.params)+"; payload:"+JSON.stringify(b.data)),a.executeHttp(b.method,b.url+b.params,b.data,a.dispatchSuccessResponse,b,a.dispatchErrorResponse)}catch(c){a.isOngoingQuery=!1,a.sendErrorMessage("exception thrown while firing query: "+c)}},a.dispatchErrorResponse=function(b){"Simple"===a.state.query.type&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),"Async"===a.state.query.type&&(a.state.info.http.rawcallbackresponse=JSON.stringify(b)),a.clearAsync(),a.isOngoingQuery=!1,a.sendErrorMessage("Query execution failed. Check error in service response for more details.")},a.sendErrorMessage=function(b){throw a.$broadcast("errormessage",b),new Error(b)},a.executeHttp=function(b,c,d,e,f,g){var h=c,i=d,j=b;if(!c)throw new Error("service url is null.");c.startsWith("http")&&(h=a.restprefix+"/viz/proxy",i=a.proxify(c,b,d),j="Post"),a.doExecuteHttp(j,h,i,e,f,g)},a.proxify=function(a,b,c){return{url:a,method:b,data:c}},a.doExecuteHttp=function(a,b,c,d,f,g){"Get"===a&&e.get(b).then(function(a){d(a,f)},function(a){g(a)}),"Post"===a&&e.post(b,c).then(function(a){d(a,f)},function(a){g(a)}),"Delete"===a&&e["delete"](b,c).then(function(a){d(a,f)},function(a){g(a)}),"Put"===a&&e.put(b,c).then(function(a){d(a,f)},function(a){g(a)}),"Patch"===a&&e.patch(b,c).then(function(a){d(a,f)},function(a){g(a)})},a.dispatchSuccessResponse=function(b,c){try{if("Simple"===a.state.query.type&&a.loadData(b,c),"Async"===a.state.query.type){a.state.info.http.asynccheckpoint=!0;var d=a.state.query.datasource.service,e=a.state.query.datasource.callback;a.isRawDisplay&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),a.state.query.datasource.service.postproc.save&&(a.state.data.state=runResponseProc(d.postproc.save["function"],null,b));var f=a.executeReplace(e,a.state.data.placeholdersstate);a.isRawDisplay&&(a.state.info.http.callbacksent="url :"+JSON.stringify(f.url)+"; payload:"+JSON.stringify(f.data));var g=function(){a.executeHttp(e.method,f.url,f.data,a.loadData,e,a.dispatchErrorResponse)};a.setAsyncInterval(g)}}catch(h){a.clearAsync(),a.isOngoingQuery=!1,a.sendErrorMessage("An error occured while processing response:"+h)}},a.executeReplace=function(b,c){var d;c&&a.state.data.state?d=c.concat(a.state.data.state):(c&&(d=c),a.state.data.state&&(d=a.state.data.state));var e=b.data,f=b.url;if(b.preproc.replace&&b.preproc.replace["function"]){var g;if(e)try{g=runRequestProc(b.preproc.replace["function"],e,d),e=JSON.parse(g)}catch(h){a.sendErrorMessage("An issue occured while replacing payload data: "+h)}if(f)try{g=runRequestProc(b.preproc.replace["function"],f,d),f=g}catch(h){a.sendErrorMessage("An issue occured while replacing url params: "+h)}}return{data:e,url:f}},a.setAsyncInterval=function(b){a.clearAsync();var c=setIntervalAsyncDefault;a.state.config.asyncrefreshduration&&(c=a.state.config.asyncrefreshduration),a.asyncInterval=setInterval(b,c)},a.clearAsync=function(){a.asyncInterval&&(clearInterval(a.asyncInterval),a.state&&a.state.title?a.$emit("async-query-cycle-complete",a.state.title):console.log("Warning: clearAsync was called while state or state.title was null or undefined."))},a.loadData=function(b,c){if("Simple"===a.state.query.type&&(a.isRawDisplay&&(a.state.info.http.rawserviceresponse=JSON.stringify(b)),a.isOngoingQuery=!1),"Async"===a.state.query.type){if(a.asyncInterval)try{runResponseProc(a.state.query.datasource.callback.postproc.asyncEnd["function"],null,b)&&(a.clearAsync(),a.isOngoingQuery=!1)}catch(d){a.clearAsync(),a.sendErrorMessage("An error occured while checking async response completeness"+d)}a.isRawDisplay&&(a.state.info.http.rawcallbackresponse=JSON.stringify(b))}a.state.data.rawresponse={dashdata:b}},a.state.unwatchers.push(a.$watch("state.data.rawresponse",function(b){var c=void 0;if("Simple"===a.state.query.type&&(c=a.state.query.datasource.service),"Async"===a.state.query.type&&(c=a.state.query.datasource.callback),c&&c.postproc&&b&&b.dashdata)if(c.postproc.transform["function"]&&c.postproc.transform["function"].length>0&&a.loaded)try{var d={dashdata:runResponseProc(c.postproc.transform["function"],keyvalarrayToIndex(evalDynamic(c.postproc.transform.args),"key","value"),b.dashdata)};if(a.state.data.transformed&&a.state.data.transformed.dashdata&&d&&d.dashdata&&"On"===a.state.config.incremental){if(a.state.data.transformed.dashdata.length+d.dashdata.length>a.state.config.incmaxdots){var e=a.state.data.transformed.dashdata.length+d.dashdata.length-a.state.config.incmaxdots;a.state.data.transformed.dashdata=a.state.data.transformed.dashdata.splice(e,a.state.data.transformed.dashdata.length-1)}a.state.data.transformed={dashdata:a.state.data.transformed.dashdata.concat(d.dashdata)}}else a.state.data.transformed=d}catch(f){a.sendErrorMessage("An error occured while performing transformation:"+f)}else a.sendErrorMessage("Warning: a new raw value was read by widget with id : "+a.widgetid+" but no transform function was provided")})),a.clearAutorefreshInterval=function(){a.autorefreshInterval&&clearInterval(a.autorefreshInterval)},a.restartInterval=function(b){a.clearAutorefreshInterval(),"On"===b&&a.setAutorefreshInterval()},a.state.unwatchers.push(a.$watch("state.config.autorefresh",function(b){a.restartInterval(b)}));var h=function(){if(!a.isOngoingQuery)try{a.fireQuery()}catch(b){a.sendErrorMessage("[Autorefresh] unable to refresh due to error: "+b+"; Starting new query."),a.clearAutorefreshInterval(),a.isOngoingQuery=!1}};a.setAutorefreshInterval=function(){var b=setIntervalDefault;a.state.config.autorefreshduration&&(b=a.state.config.autorefreshduration),g(function(){h()}),a.autorefreshInterval=setInterval(function(){h()},b)},a.$on("firequery",function(){a.fireQuery()}),a.$on("fireQueryDependingOnContext",function(){a.fireQueryDependingOnContext()}),a.$on("templateph-loaded",function(){a.state.query.controls&&a.state.query.controls.template&&a.state.query.paged.ispaged&&a.initPaging()}),a.$watch("state.query.paged.ispaged",function(b){"On"===b&&a.initPaging()}),a.$on("firenext",function(){a.nextPaging()}),a.$on("fireprevious",function(){a.previousPaging()}),a.$on("template-updated",function(){a.fireQuery()}),a.$on("dashboard-data-clear",function(){console.log("clearing data."),a.clearData()}),a.initPaging=function(){var b=a.state.query.paged;b&&b.offsets&&b.offsets.first&&(b.offsets.first.state=runValueFunction(b.offsets.first.start),b.offsets.second&&(b.offsets.second.state=runValueFunction(b.offsets.second.start))),a.$broadcast("update-template-nofire")},a.nextPaging=function(){var b=a.state.query.paged;b.offsets.first.state=runValueFunction(b.offsets.first.next,b.offsets.first.state),b.offsets.second&&(b.offsets.second.state=runValueFunction(b.offsets.second.next,b.offsets.second.state)),a.$broadcast("update-template")},a.previousPaging=function(){var b=a.state.query.paged;b.offsets.first.state=runValueFunction(b.offsets.first.previous,b.offsets.first.state),b.offsets.second&&(b.offsets.second.state=runValueFunction(b.offsets.second.previous,b.offsets.second.state)),a.$broadcast("update-template")},a.terminate=function(){console.log("["+a.widgetid+"] terminating..."),f.unregisterWidget(a.widgetid),a.clearAsync(),a.clearAutorefreshInterval(),a.state.config.autorefresh="Off",a.state.data={},a.state=null,console.log("["+a.widgetid+"] termination complete.")},a.unwatchAll=function(){$.each(a.state.unwatchers,function(a,b){b()})},a.$on("dashletinput-ready",function(){a.isAlreadyData()||a.fireQueryDependingOnContext(),a.loaded=!0}),a.isAlreadyData=function(){return a.state.data.rawresponse||a.state.data.transformed||a.state.gui.chartdata&&a.state.gui.chartdata.length>0||a.state.gui.tabledata},a.clearData=function(){a.state.data.rawresponse=null,a.state.data.transformed=null,a.state.gui.chartdata=[],a.state.gui.tabledata=null},a.$on("globalsettings-refreshToggle",function(b,c){c["new"]===!0?a.state.config.slave||(a.state.config.autorefresh="On"):a.state.config.autorefresh="Off"}),a.$on("globalsettings-refreshInterval",function(b,c){c["new"]>0&&(a.state.config.slave||(a.state.config.autorefreshduration=c["new"],a.restartInterval(a.state.config.autorefresh)))}),a.$on("$destroy",function(){a.terminate()})}}}),registerScript(),angular.module("viz-mgd-widget",["viz-dashlet"]).directive("vizMgdWidget",function(){return{restrict:"E",scope:{displaymode:"=",widgetid:"=",wstate:"=",state:"=",headersheightinput:"=",charttocontainerinput:"=",presets:"=",restprefix:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-mgd-widget.js","viz-mgd-widget.html"),controller:function(a,b){a.computeHeights=function(){a.generalThicknessOffset=100,a.headersheight=a.headersheightinput,a.charttocontainerinput?a.charttocontainer=a.charttocontainerinput:a.charttocontainer=30;var b=window.innerHeight;a.chartHeightSmall=(b-a.headersheight-a.generalThicknessOffset)/2-a.charttocontainer,a.chartHeightBig=(b-a.headersheight-a.generalThicknessOffset)/1-a.charttocontainer,a.chartWidthSmall=0,a.chartWidthBig=0,a.innerContainerHeightSmall=(b-a.headersheight-a.generalThicknessOffset)/2,a.innerContainerHeightBig=(b-a.headersheight-a.generalThicknessOffset)/1,a.innerContainerWidthSmall=0,a.innerContainerWidthBig=0},a.getActualDashletWidth=function(){return b[0].children[0].children[0].offsetWidth},a.updateSize=function(){a.computeHeights();var b=.9*a.getActualDashletWidth(),c=a.state.options;c.chart.width=b,c.innercontainer.width=b-50,"col-md-6"===a.wstate.widgetwidth?(c.chart.height=a.chartHeightSmall,c.innercontainer.height=a.innerContainerHeightSmall):(c.chart.height=a.chartHeightBig,c.innercontainer.height=a.innerContainerHeightBig),a.state.savedHeight=a.state.options.innercontainer.height},a.startup=function(){a.state.options.innercontainer.height&&0!==a.state.options.innercontainer.height||$(document).ready(function(){a.resize()}),a.state.savedHeight=a.state.options.innercontainer.height},a.startup(),a.toggleAutorefresh=function(){a.$broadcast("globalsettings-refreshToggle",{"new":!a.wstate.autorefresh})},a.$watch("state.config.autorefresh",function(b){"On"===b?a.wstate.autorefresh=!0:a.wstate.autorefresh=!1}),a.toggleChevron=function(){a.wstate.chevron?a.collapse():a.restore(),a.wstate.chevron=!a.wstate.chevron},a.saveDimensions=function(){a.state.savedHeight=a.state.options.innercontainer.height},a.collapse=function(){a.saveDimensions(),a.state.options.innercontainer.height=30},a.restore=function(){a.state.options.innercontainer.height=a.state.savedHeight},a.resize=function(){a.updateSize(),forceRedraw(a),a.$broadcast("resized")},a.extend=function(){a.wstate.widgetwidth="col-md-12",$(document).ready(function(){a.resize()})},a.moveLeft=function(){a.$emit("mgdwidget-moveLeft",{wid:a.widgetid}),console.log("["+a.widgetid+"] moveLeft")},a.moveRight=function(){a.$emit("mgdwidget-moveRight",{wid:a.widgetid}),console.log("["+a.widgetid+"] moveRight")},a.reduce=function(){a.wstate.widgetwidth="col-md-6",a.aggressiveResize()},a.aggressiveResize=function(){$(document).ready(function(){a.resize(),a.agressiveRefresh()})},a.agressiveRefresh=function(){a.moveRight(),forceRedraw(a),a.moveLeft(),forceRedraw(a)},a.removeWidget=function(){a.$emit("mgdwidget-remove",{wid:a.widgetid})},a.$on("resize-widget",function(){a.resize()})}}}),registerScript(),angular.module("viz-query",["viz-view","ui.bootstrap","key-val-collection","rtm-controls"]).directive("vizQuery",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-query.html"),controller:function(a){}}}).directive("vizTransform",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-transform.html"),controller:function($scope){$scope.loadTicks=function(){$scope.state.options.chart.xAxis&&($scope.state.options.chart.xAxis.tickFormat=eval("("+$scope.state.options.chart.xAxis.strTickFormat+")")),$scope.state.options.chart.yAxis&&($scope.state.options.chart.yAxis.tickFormat=eval("("+$scope.state.options.chart.yAxis.strTickFormat+")"))},$scope.loadScales=function(){$scope.state.options.chart.xAxis.strScale&&($scope.state.options.chart.xAxis.scale=eval("("+$scope.state.options.chart.xAxis.strScale+")")),$scope.state.options.chart.yAxis.strScale&&($scope.state.options.chart.yAxis.scale=eval("("+$scope.state.options.chart.yAxis.strScale+")"))},$scope.toDynamicDateFormat=function(a){var b=0,c=0;$scope.state.data.transformed&&$scope.state.data.transformed.dashdata&&(c=$scope.state.data.transformed.dashdata.length),c>1&&(b=$scope.state.data.transformed.dashdata[c-1].x-$scope.state.data.transformed.dashdata[0].x);var d="%H:%M:%S";b>144e5&&(d="%Y.%m.%d %H:%M");var e=d3.time.format(d)(new Date(a));return e},$scope.$on("reload-scales",function(a,b){b&&((b.xAxis||""===b.xAxis)&&($scope.state.options.chart.xAxis.strScale=b.xAxis),(b.yAxis||""===b.yAxis)&&($scope.state.options.chart.yAxis.strScale=b.yAxis)),$scope.loadScales(),$scope.loadTicks()}),$scope.startup=function(){$scope.loadTicks()},$scope.startup()}}}).directive("vizConfig",function(a){return{restrict:"E",scope:{widgetid:"=",state:"=",presets:"=",inputsettingscol:"=",showcoms:"=?"},templateUrl:resolveTemplateURL("viz-query.js","viz-config.html"),controller:function(b){b.viztypes=["table","seriesTable","dualTable","singleValueTable","singleValueFullText","lineChart","multiBarChart","scatterChart","discreteBarChart","stackedAreaChart"],b.loadConfigPreset=function(a){b.state.config=jsoncopy(a)},b.loadMaster=function(a){b.$emit("master-loaded",a)},b.undoMaster=function(){a.unregisterWidget(b.widgetid),b.unwatchMaster&&b.unwatchMaster()},b.undoSlave=function(){b.unwatchSlave&&b.unwatchSlave()},b.$on("coms-reset",function(){b.state.config.master&&(b.state.config.master=!b.state.config.master),b.undoMaster(),b.state.config.slave&&(b.state.config.slave=!b.state.config.slave),b.undoSlave()}),b.makeMaster=function(c){c?b.undoMaster():(a.registerWidget(b.widgetid,b.state.title),b.unwatchMaster=b.$watchCollection("state.data.transformed",function(c){c?a.updateMasterValue(b.widgetid,{transformed:angular.toJson(c.dashdata),raw:angular.toJson(b.state.data.rawresponse.dashdata)}):console.log("Warning: a failed transformation occured, we are not broadcasting new value to slaves.")}))},b.$on("isMaster-changed",function(a,c){b.makeMaster(c)}),b.state.unwatchers?b.state.unwatchers.push(b.$watch("state.title",function(c){b.state.config.master&&a.udpdateTitle(b.widgetid,c)})):b.state.unwatchers=[],b.unwatchSlave="",b.startWatchingMaster=function(c){if(b.state.config.slave){var d=b.$watch(function(){return a.buffer[c]},function(a){if(a)try{if(b.state.config.target){var c=b.state.config.target;if("state.data.transformed"===c)try{b.state.data.transformed={dashdata:JSON.parse(a.transformed)}}catch(d){console.log("Warning: error occured ("+d.toString()+"). Could not parse transformed object."),console.log(a.transformed)}if("state.data.rawresponse"===c)try{b.state.data.rawresponse={dashdata:JSON.parse(a.raw)}}catch(d){console.log("Warning: error occured ("+d.toString()+"). Could not parse rawresponse object."),console.log(a.raw)}}else console.log("slave target is undefined.")}catch(d){console.log(d)}else console.log("Warning: an undefined newvalue has been read by slave with id:"+b.widgetid)});b.unwatchSlave=d}},b.state.unwatchers.push(b.$watch("state.config.slave",function(a){a||b.undoSlave()})),b.$on("master-loaded",function(a,c){b.undoSlave(),b.state.config.currentmaster=c,b.startWatchingMaster(c.oid)}),b.state.unwatchers.push(b.$watch(function(){return a.masters},function(a){b.state.config.masters=a})),b.$on("single-remove",function(a,c){c===b.widgetid&&b.prepareRemove()}),b.$on("global-remove",function(a,c){b.prepareRemove()}),b.prepareRemove=function(){b.state.config.master&&a.unregisterWidget(b.widgetid)},b.state.config.currentmaster&&$(document).ready(function(){b.startWatchingMaster(b.state.config.currentmaster.oid)}),b.state.config.master&&b.makeMaster(!1)}}}).directive("vizInfo",function(){return{restrict:"E",scope:{widgetid:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-info.html"),controller:function(a){a.errorboxcolor="gray",a.$on("cleanup-info",function(){a.state.info.http.rawserviceresponse="",a.state.info.http.rawcallbackresponse="",a.state.info.http.callbacksent="",a.state.info.http.servicesent=""}),a.sendSaveEvent=function(){a.$emit("dashlet-save",jsoncopy({oid:a.widgetid,state:a.state}))},a.sendCopyEvent=function(){a.$emit("dashlet-copy",jsoncopy({oid:a.widgetid,state:a.state}))},a.clearMessages=function(){a.state.info.alert.message="",a.state.info.alert.counter=0},a.$on("errormessage",function(b,c){a.state.info.alert.message=c+"\n\n"+a.state.info.alert.message,a.state.info.alert.counter++}),a.$on("clearmessages",function(){a.clearMessages()}),a.$watch("state.info.alert.counter",function(b){b>0?a.errorboxcolor="#ff7a00":a.errorboxcolor="gray"})}}}).directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return JSON.parse(a)}function f(a){return JSON.stringify(a)}d.$parsers.push(e),d.$formatters.push(f)}}}).directive("evalString",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return function(a){return 1}}function f(a){return a.toString()}console.log("evalString!!"),d.$parsers.push(e),
d.$formatters.push(f)}}}).directive("vizQService",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-service.html"),controller:function(a){a.initAsync=function(){var b=JSON.parse(angular.toJson(a.state.query.datasource.service));a.state.query=new DefaultAsyncQuery,a.state.query.datasource.service=b}}}}).directive("vizQInput",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-input.html"),controller:function(a){a.initControls=function(){a.state.query.controls=new DefaultControls,a.state.query.paged=new DefaultPaging},a.$watch("state.query.controltype",function(b){"Plain"===b&&(a.state.query.controls.template.placeholders||(a.state.query.controls.template.placeholders=[]),a.$watch("state.query.controls.template.placeholders",function(b){a.templateChange()},!0),a.$watch("state.query.controls.template.templatedPayload",function(b){a.templateChange()},!0))}),a.initTemplate=function(){a.state.query.controls.template=new DefaultTemplate},a.loadQueryPreset=function(b){var c=jsoncopy(b);a.state.query=c.query},a.$watch("inputsettingscol",function(b){a.templateChange()},!0),a.processTemplate=function(){if(a.state.query&&a.state.query.controls&&a.state.query.controls.template){var b="",c="";return a.state.data.placeholdersstate=evalDynamic(a.mergePlaceholders()),a.state.query.datasource.service.preproc.replace["function"]&&(a.state.query.controls.template.templatedPayload&&(b=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedPayload,a.state.data.placeholdersstate)),a.state.query.controls.template.templatedParams&&(c=runRequestProc(a.state.query.datasource.service.preproc.replace["function"],a.state.query.controls.template.templatedParams,a.state.data.placeholdersstate))),{data:b,params:c}}return null},a.mergePlaceholders=function(b){var c="",d="",e=[];return a.state.query.controls.template&&a.state.query.controls.template.placeholders&&(c=JSON.parse(JSON.stringify(a.state.query.controls.template.placeholders))),a.inputsettingscol&&(d=JSON.parse(JSON.stringify(a.inputsettingscol))),a.state.query.controls.template&&"On"===a.state.query.paged.ispaged&&(e.push({key:a.state.query.paged.offsets.first.vid,value:a.state.query.paged.offsets.first.state}),a.state.query.paged.offsets.second&&e.push({key:a.state.query.paged.offsets.second.vid,value:a.state.query.paged.offsets.second.state})),d.concat(c).concat(e)},a.loadTemplatePreset=function(b){var c=jsoncopy(b);a.state.query=c.queryTemplate,a.state.query.controls||(a.state.query.controls={template:{}}),a.state.query.controls.template.templatedPayload=c.templatedPayload,a.state.query.controls.template.templatedParams=c.templatedParams,a.state.query.controls.template.placeholders=c.placeholders,a.$emit("templateph-loaded")},a.$on("update-template-nofire",function(){a.templateChange()}),a.$on("update-template",function(){a.templateChange(),a.$emit("template-updated")}),a.$on("cleanup-info",function(){a.templateChange()}),a.templateChange=function(){var b=a.processTemplate();b&&(a.state.query.datasource.service.data=b.data,a.state.query.datasource.service.params=b.params)},a.$emit("dashletinput-ready")}}}).directive("vizQPreproc",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-preproc.html"),controller:function(a){}}}).directive("vizQPostproc",function(){return{restrict:"E",scope:{state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-q-postproc.html"),controller:function(a){}}}),registerScript(),angular.module("viz-session-manager",["viz-dashboard-manager","ui.bootstrap"]).directive("vizSessionManager",function(){return{restrict:"E",scope:{presets:"=",dashboards:"=",displaymode:"=",headermargin:"=",restprefix:"=",currentsession:"="},templateUrl:resolveTemplateURL("viz-session-manager.js","viz-session-manager.html"),controller:function(a,b,c,d){a.dashboards||(a.stdldashboards=[]),a.staticPresets=new StaticPresets,a.deriveEventName=function(a){return a.split(".")[1]},a.$on("sb.dashboard-new",function(b,c){c&&"explore"===c?a.$broadcast(a.deriveEventName(b.name),{displaytype:"exploded"}):a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.dashboard-clear",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.dashboard-data-clear",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.fireQueryDependingOnContext",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.dashboard-current-addWidget",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.dashboard-current-clearWidgets",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.dashboard-configure",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.docs",function(b){a.$broadcast(a.deriveEventName(b.name))}),a.$on("sb.saveSession",function(b){a.saveSession(a.currentsession)}),a.$on("sb.loadSession",function(b){a.loadSession(a.currentsession)}),a.$on("sb.deleteSession",function(b){a.deleteSession(a.currentsession)}),a.$on("sb.sessionSelected",function(b,c){a.currentsession=c,a.loadSession(a.currentsession)}),a.$on("sb.freshSession",function(b,c){a.currentsession=c,a.dashboards=[new DefaultDashboard]}),a.saveSession=function(c){var d=angular.toJson({name:c,state:a.dashboards});b.post(a.restprefix+"/viz/crud/sessions?name="+c,d).then(function(a){console.log("response"),console.log(a)},function(a){console.log("error response"),console.log(a)})},a.loadSession=function(c){a.dashboards.length=0,b.get(a.restprefix+"/viz/crud/sessions?name="+c).then(function(b){b&&b.data&&b.data.object.state&&b.data.object.state.length>0&&$.each(b.data.object.state,function(b,c){a.dashboards.push(c)})},function(a){console.log("error response"),console.log(a)})},a.deleteSession=function(c){b["delete"](a.restprefix+"/viz/crud/sessions?name="+c).then(function(a){console.log("response"),console.log(a)},function(a){console.log("error response"),console.log(a)})},a.popTable=function(){var b=this;b.animationsEnabled=!0,b.tableElementParent=angular.element(c).find("sessionSearchParent");var e=d.open({animation:b.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:resolveTemplateURL("viz-session-manager.js","tableModal.html"),controller:"SessionSearchModal",controllerAs:"$ctrl",size:"lg",appendTo:b.tableElementParent,resolve:{dataUrl:function(){return a.restprefix+"/viz/crud/paged/sessions"},tableElementParent:function(){return b.tableElementParent}}});e.result.then(function(b){a.$emit("sb.sessionSelected",b[0])},function(){$log.info("Modal dismissed at: "+new Date)})},a.popNewSession=function(){var b=this;b.animationsEnabled=!0,b.tableElementParent=angular.element(c).find("sessionNewParent");var e=d.open({animation:b.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:resolveTemplateURL("viz-session-manager.js","singleInputModal.html"),controller:"SingleInputModal",controllerAs:"$ctrl",size:"sm",appendTo:b.tableElementParent,resolve:{tableElementParent:function(){return b.tableElementParent}}});e.result.then(function(b){a.$emit("sb.freshSession",b)},function(){})}}}}).controller("SingleInputModal",function(a,b,c){var d=this;d.selected="",d.ok=function(){b.close(a.selected)},d.cancel=function(){b.dismiss("cancel")}}).controller("SessionSearchModal",function(a,b,c,d){var e=this;e.selected="",$(document).ready(function(){e.tableElement=angular.element(c).find("table"),e.table=e.tableElement.DataTable({processing:!0,serverSide:!0,ajax:{url:d,type:"POST"},select:!0,order:[[0,"asc"]]}),e.tableElement.on("click","tr",function(){e.selected=e.table.row(this).data()})}),e.ok=function(){b.close(e.selected)},e.cancel=function(){b.dismiss("cancel")}}).directive("vizToolbar",function(){return{restrict:"E",scope:{dashboards:"=",restprefix:"="},templateUrl:resolveTemplateURL("viz-session-manager.js","viz-toolbar.html"),controller:function(a){}}}),window.alert=function(){var a=window.alert;return function(b){0===b.indexOf("DataTables warning")?console.warn(b):a(b)}}(),registerScript(),angular.module("viz-view",["nvd3"]).directive("vizView",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-query.js","viz-view.html"),controller:function($scope){$scope.colorFunction=stringToColour,$scope.state.options.chart.colorFunction&&($scope.colorFunction=$scope.state.options.chart.colorFunction),$scope.customheight&&($scope.state.options.chart.height=customheight-10),$scope.state.unwatchers.push($scope.$watchCollection("state.data.transformed",function(a){if($scope.cleanupTooltips(!0),a&&a.dashdata){if($scope.state.options.chart.type.endsWith("seriesTable")&&($scope.state.gui.tabledata=$scope.toTable(a.dashdata)),$scope.state.options.chart.type.endsWith("dualTable")){var b=$scope.state.options.chart.dualzx;!b||b.length<2?$scope.state.gui.tabledata=vizmdTransformation.toPlainTable(vizmdTransformation.toDualGrouping(a.dashdata,"z","x"),"xAxis","series"):$scope.state.gui.tabledata=vizmdTransformation.toPlainTable(vizmdTransformation.toDualGrouping(a.dashdata,b.substring(0,1),b.substring(1,2)),"xAxis","series")}else"table"===$scope.state.options.chart.type&&($scope.state.gui.tabledata=a.dashdata);$scope.state.options.chart.type.endsWith("Chart")&&($scope.state.gui.chartdata=$scope.toChart(a.dashdata),$scope.reapplyScales()),"On"===$scope.state.info.showraw&&($scope.state.info.transformresult=angular.toJson(a.dashdata)),$(document).ready(function(){$scope.cleanupTooltips(!1)})}})),$scope.cleanupTooltips=function(a){for(;$("div.nvtooltip").length>1;)$("div.nvtooltip").first().remove();a&&d3.selectAll(".nvtooltip").style("opacity","0")},$scope.$on("$destroy",function(){$scope.cleanupTooltips()}),$scope.applyDynamicChartConfig=function(){$(document).ready(function(){var a=$(".nv-axisMax-y text").text().length;$scope.state.options.chart.margin.left=35+5*a})},$scope.reapplyScales=function(){$scope.state.options.chart.xAxis&&($scope.state.options.chart.xDomain=eval($scope.state.options.chart.xAxis.strScale)),$scope.state.options.chart.yAxis&&($scope.state.options.chart.yDomain=eval($scope.state.options.chart.yAxis.strScale))},$scope.$on("resized",function(){}),$scope.formatPotentialTimestamp=function(a){return formatPotentialTimestamp(a)},$scope.stringToColour=function(a){return stringToColour(a)},$scope.isPagingOff=function(){return $scope.state.query.controls&&$scope.state.query.controls.template&&$scope.state.query.paged.ispaged?"Off"===$scope.state.query.paged.ispaged:!0},$scope.toChart=function(a){for(var b="x",c="y",d="z",e=[],f={},g=a,h=0;h<g.length;h++){var i=g[h][d];i in f||(e.push({values:[],key:i,color:$scope.colorFunction(i),strokeWidth:3,classed:"dashed"}),f[i]=e.length-1),e[f[i]].values.push({x:g[h][b],y:g[h][c]})}return e},$scope.toTable=function(a){for(var b="x",c="y",d="z",e=[],f={},g=[],h=a,i=0;i<h.length;i++){var j=h[i][b];j in f||(e.push({values:{},x:j}),f[j]=e.length-1),e[f[j]].values[h[i][d]]=h[i][c],g.includes(h[i][d])||g.push(h[i][d])}return{zlist:g.sort(),data:e}},$scope.$on("$destroy",function(){$scope.cleanupTooltips()})}}}).directive("vizVSeriestable",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-view.js","viz-v-seriestable.html"),controller:function(a){a.stringToColour=function(a){return stringToColour(a)}}}}).directive("vizVDualtable",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-view.js","viz-v-dualtable.html"),controller:function(a){a.stringToColour=function(a){return stringToColour(a)}}}}).directive("vizVSinglevaluetable",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-view.js","viz-v-singlevaluetable.html"),controller:function(a){a.stringToColour=function(a){return stringToColour(a)}}}}).directive("vizVValuefulltext",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-view.js","viz-v-singlevaluefulltext.html"),controller:function(a){a.stringToColour=function(a){return stringToColour(a)}}}}).directive("vizVChart",function(){return{restrict:"E",scope:{customheight:"=",state:"=",presets:"=",inputsettingscol:"="},templateUrl:resolveTemplateURL("viz-view.js","viz-v-chart.html"),controller:function(a){a.stringToColour=function(a){return stringToColour(a)}}}}),registerScript(),angular.module("viz",["viz-dashboard-manager"]).directive("viz",function(){return{restrict:"E",scope:{},templateUrl:resolveTemplateURL("viz.js","viz.html"),controller:function(a){a.staticPresetsInstance=new StaticPresets,a.dashboardsendpoint=[new DefaultDashboard([new DefaultWidget]),new DefaultExplorationDashboard],a.$on("top.dashboard-new",function(b,c){a.$broadcast("dashboard-new",c)}),a.$on("top.dashboard-clear",function(){a.$broadcast("dashboard-clear")}),a.$on("top.dashboard-current-addWidget",function(){a.$broadcast("dashboard-current-addWidget")}),a.$on("top.dashboard-current-clearWidgets",function(){a.$broadcast("dashboard-current-clearWidgets")}),a.$on("dashlet-save",function(b,c){a.dashboardsendpoint.push(new DefaultDashboard([new Widget(getUniqueId(),new DefaultWidgetState,c.state)]))})}}});var vizmdTransformation={};vizmdTransformation.toDualGrouping=function(a,b,c,d){var e=new IdIndexArray([]),f=[],g=[],h=[],i="";i="undefined"!=typeof inputMkey&&inputMkey?d:"m",$.each(a,function(a,b){h.includes(b[i])||h.push(b[i])}),$.each(a,function(a,d){e.hasById(d[b])||(e.addNewWithId(new IdIndexArray([]),d[b]),f.push(d[b]));var h=e.getById(d[b]),i=d[c];h.hasById(i)||(h.addNewWithId({values:{}},i),g.includes(i)||g.push(i));var j=h.getById(d[c]);j.values[d.m]=d.y});var j={data:JSON.parse(JSON.stringify(e)),zList:f,xList:g,mList:h};return j},vizmdTransformation.toPlainTable=function(a,b,c){var d=[],e=[];return e.push(b),e.push(c),$.each(a.mList,function(a,b){e.push(b)}),$.each(a.data.array,function(b,c){$.each(c.array,function(b,e){var f=[];f.push(c.oid),f.push(e.oid),$.each(a.mList,function(a,b){e.values&&e.values[b]?f.push(e.values[b]):f.push(null)}),d.push(f)})}),{data:d,headers:e}};