<div stepPlanEditorKeyHandler>
  <as-split direction="horizontal">
    <as-split-area [size]="75">
      <mat-card>
        <mat-card-title class="editor-header">
          {{ plan?.root?._class || '' }} - {{plan?.attributes?.['name']}}
          <step-btn-group>
            <button
              type="button"
              mat-flat-button
              *ngIf="hasUndo$ | async"
              (click)="discardAll()"
              matTooltip="revert all changes"
              matTooltipPosition="below"
            >
              Discard All
            </button>
            <button
              type="button"
              mat-icon-button
              [disabled]="!(hasUndo$ | async)"
              (click)="undo()"
              matTooltip="Undo (ctrl+z)"
              matTooltipPosition="below"
            >
              <step-icon class="icon-flipped" name="rotate-cw"></step-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              [disabled]="!(hasRedo$ | async)"
              (click)="redo()"
              matTooltip="Redo (ctrl+y)"
              matTooltipPosition="below"
            >
              <step-icon name="rotate-cw"></step-icon>
            </button>
            <button type="button" mat-flat-button (click)="clonePlan()">Clone</button>
            <button type="button" mat-flat-button (click)="exportPlan()">Export</button>
            <button type="button" mat-icon-button color="primary" [matMenuTriggerFor]="executionMenu">
              <step-icon name="play"></step-icon>
            </button>
            <mat-menu #executionMenu="matMenu">
              <span
                class="plan-execution-menu"
                mat-menu-item
                [disableRipple]="true"
                (click)="$event.stopImmediatePropagation()"
              >
                <step-plan-execution
                  [description]="plan?.attributes?.['name']"
                  [repositoryObjectRef]="repositoryObjectRef"
                >
                </step-plan-execution>
              </span>
            </mat-menu>
          </step-btn-group>
        </mat-card-title>
        <mat-card-content *ngIf="plan">
          <step-custom-form
            [stModel]="plan"
            stScreen="planTable"
            [stInline]="true"
            (stOnChange)="handlePlanChange()"
            [stDisabled]="!('plan-write' | hasRight | async)"
          >
          </step-custom-form>
          <step-plan-type [itemKey]="plan._class"> </step-plan-type>
        </mat-card-content>
      </mat-card>
    </as-split-area>
    <as-split-area [size]="25">
      <mat-card>
        <mat-card-title> Available components </mat-card-title>
        <mat-card-content>
          <step-tabs [tabs]="componentTabs" [(activeTabId)]="selectedTab" [disablePagination]="true" [shrink]="true">
          </step-tabs>
          <div class="tab-content" [ngSwitch]="selectedTab">
            <step-plan-artefact-list *ngSwitchCase="'controls'" (onSelection)="addControl($event)">
            </step-plan-artefact-list>
            <step-plan-function-list *ngSwitchCase="'keywords'" (onSelection)="addFunction($event)">
            </step-plan-function-list>
            <step-plan-otherplan-list *ngSwitchCase="'other'" (onSelection)="addPlan($event)">
            </step-plan-otherplan-list>
            <div *ngSwitchCase="'console'"></div>
          </div>
        </mat-card-content>
      </mat-card>
    </as-split-area>
  </as-split>
</div>
