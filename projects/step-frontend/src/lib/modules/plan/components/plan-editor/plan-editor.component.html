<div stepPlanEditorKeyHandler>
  <mat-card *ngIf="_interactiveSession.isActive$ | async">
    Welcome to the interactive mode. In this mode you can select tree nodes and run them directly by clicking the button
    'Run interactively'
  </mat-card>
  <as-split direction="horizontal">
    <as-split-area [size]="75">
      <mat-card class="editor-card">
        <mat-card-title class="editor-header">
          <ng-container *ngIf="_planEditService.plan$ | async as plan">
            {{ plan?.root?._class || '' }} - {{plan?.attributes?.['name']}}
          </ng-container>
          <step-btn-group>
            <button
              type="button"
              mat-flat-button
              *ngIf="_planEditService.hasUndo$ | async"
              (click)="_planEditService.discardAll()"
              matTooltip="revert all changes"
              matTooltipPosition="below"
            >
              Discard All
            </button>
            <button
              type="button"
              mat-icon-button
              [disabled]="!(_planEditService.hasUndo$ | async)"
              (click)="_planEditService.undo()"
              matTooltip="Undo (ctrl+z)"
              matTooltipPosition="below"
            >
              <step-icon class="icon-flipped" name="rotate-cw"></step-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              [disabled]="!(_planEditService.hasRedo$ | async)"
              (click)="_planEditService.redo()"
              matTooltip="Redo (ctrl+y)"
              matTooltipPosition="below"
            >
              <step-icon name="rotate-cw"></step-icon>
            </button>
            <button type="button" mat-flat-button (click)="clonePlan()">Clone</button>
            <button type="button" mat-flat-button (click)="exportPlan()">Export</button>
            <button type="button" mat-flat-button (click)="restoreVersion()">Restore version</button>
            <button
              type="button"
              mat-flat-button
              [disabled]="_interactiveSession.isActive$ | async"
              (click)="startInteractive()"
            >
              Start interactive session
            </button>
            <ng-container *ngIf="_interactiveSession.isActive$ | async">
              <button type="button" mat-flat-button (click)="resetInteractive()">Reset</button>
              <button type="button" mat-flat-button (click)="stopInteractive()">Stop</button>
              <button type="button" mat-flat-button [matMenuTriggerFor]="executionParametersMenu">
                Session parameters
              </button>
            </ng-container>
            <button type="button" mat-icon-button color="primary" [matMenuTriggerFor]="executionMenu">
              <step-icon name="play"></step-icon>
            </button>
            <mat-menu #executionParametersMenu="matMenu">
              <span
                class="plan-execution-menu"
                mat-menu-item
                [disableRipple]="true"
                (click)="$event.stopImmediatePropagation()"
              >
                <step-custom-form [stModel]="_interactiveSession.executionParameters" stScreen="executionParameters">
                </step-custom-form>
              </span>
            </mat-menu>
            <mat-menu #executionMenu="matMenu">
              <span
                class="plan-execution-menu"
                mat-menu-item
                [disableRipple]="true"
                (click)="$event.stopImmediatePropagation()"
              >
                <step-plan-execution
                  [description]="(_planEditService.plan$ | async)?.attributes?.['name']"
                  [repositoryObjectRef]="repositoryObjectRef"
                >
                </step-plan-execution>
              </span>
            </mat-menu>
          </step-btn-group>
        </mat-card-title>
        <mat-card-content *ngIf="planClass">
          <step-custom-form
            [stModel]="(_planEditService.plan$ | async)!"
            stScreen="planTable"
            [stInline]="true"
            (stOnChange)="_planEditService.handlePlanChange()"
            [stDisabled]="!('plan-write' | hasRight | async)"
          >
          </step-custom-form>
          <step-plan-type [itemKey]="planClass"> </step-plan-type>
        </mat-card-content>
      </mat-card>
    </as-split-area>
    <as-split-area [size]="25">
      <mat-card>
        <mat-card-title> Available components </mat-card-title>
        <mat-card-content>
          <step-tabs [tabs]="componentTabs" [(activeTabId)]="selectedTab" [disablePagination]="true" [shrink]="true">
          </step-tabs>
          <div class="tab-content" [ngSwitch]="selectedTab">
            <step-plan-artefact-list *ngSwitchCase="'controls'" (onSelection)="addControl($event)">
            </step-plan-artefact-list>
            <step-plan-function-list *ngSwitchCase="'keywords'" (onSelection)="addFunction($event)">
            </step-plan-function-list>
            <step-plan-otherplan-list *ngSwitchCase="'other'" (onSelection)="addPlan($event)">
            </step-plan-otherplan-list>
            <step-keyword-calls
              *ngSwitchCase="'console'"
              #keywordCalls
              [keywordParameters$]="_interactiveSession.keywordParameters$"
            >
            </step-keyword-calls>
          </div>
        </mat-card-content>
      </mat-card>
    </as-split-area>
  </as-split>
</div>
