<step-modal-window>
  <div class="tree-node-modal-header" step-modal-window-title>
    @if (selectedReportNode(); as reportNode) {
      @if (hasBackButton()) {
        <button
          type="button"
          mat-icon-button
          (click)="navigateBack()"
          matTooltip="Back"
          matTooltipPosition="below"
          tabindex="-1"
        >
          <step-icon name="arrow-left" />
        </button>
      }
      <step-report-node-icon class="artefact-icon" [node]="reportNode" />
      <step-status [status]="reportNode.status" [iconMode]="true" />
      <span>{{ reportNode.name }}</span>
      <step-alt-execution-time
        [startTime]="reportNode.executionTime"
        [duration]="reportNode.duration"
        [timeOnly]="true"
      />
      <div class="btn-show-details-container">
        <button
          type="button"
          mat-icon-button
          matTooltip="Show plan node details"
          matTooltipPosition="below"
          [routerLink]="['.', 'plan-node']"
          [relativeTo]="_activatedRoute"
          [queryParams]="{ reportNodeId: reportNode.id }"
          queryParamsHandling="merge"
        >
          <step-icon name="external-link" />
        </button>
      </div>
    } @else {
      <span>Iteration list</span>
    }
  </div>
  <div step-modal-window-body>
    @if (hasData()) {
      @if (selectedReportNode(); as reportNode) {
        <step-alt-report-node-details
          [node]="reportNode"
          [showArtefact]="true"
          (openTreeView)="handleOpenTreeView(reportNode)"
        />
      } @else {
        <div class="aggregated-data-container">
          <div class="iteration-list">
            <step-aggregated-tree-node-iteration-list
              [node]="aggregatedNode!"
              [resolvedPartialPath]="resolvedPartialPath"
              [initialStatus]="initialSearchStatus"
              [initialStatusCount]="initialSearchStatusCount"
              (showDetails)="handleOpenDetails($event)"
              (openTreeView)="handleOpenTreeView($event)"
            />
          </div>
          <div class="history">
            <div class="title">History (8 previous executions)</div>
            <step-aggregated-tree-node-history [node]="aggregatedNode!" />
          </div>
        </div>
      }
    }
  </div>
</step-modal-window>
