<step-modal-window>
  <div class="tree-node-modal-header" step-modal-window-title>
    @if (selectedReportNode(); as reportNode) {
      @if (hasBackButton()) {
        <button
          type="button"
          mat-icon-button
          (click)="navigateBack()"
          matTooltip="Back"
          matTooltipPosition="below"
          tabindex="-1"
        >
          <step-icon name="arrow-left" />
        </button>
      }
      <step-report-node-icon class="artefact-icon" [node]="reportNode" />
      <step-status [status]="reportNode.status" [iconMode]="true" />
      <span>{{ reportNode.name }}</span>
      <step-alt-execution-time
        [startTime]="reportNode.executionTime"
        [duration]="reportNode.duration"
        [timeOnly]="true"
      />
      <div class="btn-show-details-container">
        <button
          type="button"
          mat-icon-button
          matTooltip="Show plan node details"
          matTooltipPosition="below"
          [routerLink]="['.', 'plan-node']"
          [relativeTo]="_activatedRoute"
          [queryParams]="{ reportNodeId: reportNode.id }"
          queryParamsHandling="merge"
        >
          <step-icon name="external-link" />
        </button>
      </div>
    } @else {
      <span>Iteration list</span>
    }
  </div>
  <div step-modal-window-body>
    @if (hasData()) {
      <div class="panel-container">
        <div class="main-content">
          @if (selectedReportNode(); as reportNode) {
            <step-alt-report-node-details
              [node]="reportNode"
              [showArtefact]="true"
              (openTreeView)="handleOpenTreeView(reportNode!)"
            />
          } @else {
            <div class="iteration-list">
              @if (aggregatedNode(); as aggregatedNode) {
                <step-aggregated-tree-node-iteration-list
                  [node]="aggregatedNode!"
                  [resolvedPartialPath]="resolvedPartialPath"
                  [initialStatus]="initialSearchStatus"
                  [initialStatusCount]="initialSearchStatusCount"
                  (showDetails)="handleOpenDetails($event)"
                  (openTreeView)="handleOpenTreeView($event)"
                />
              }
            </div>
          }
        </div>
        <div class="history">
          <div class="title">
            @if (isScheduledExecution()) {
              Schedule Execution History
              <step-icon
                class="help-icon"
                matTooltip="Shows the results of this step in previous executions of the same schedule. Each circle represents one scheduled plan execution. If the step was executed multiple times within a plan, the success and failure ratio is displayed as a pie chart."
                name="help-circle"
              />
            } @else {
              Execution History
              <step-icon
                class="help-icon"
                matTooltip="Shows the results of this step in previous plan executions. Each circle represents one plan execution. If the step was executed multiple times within a plan, the success and failure ratio is displayed as a pie chart."
                name="help-circle"
              />
            }
          </div>
          <step-aggregated-tree-node-history
            [artefactHash]="(aggregatedNode()?.artefactHash || selectedReportNode()?.artefactHash)!"
            [previousExecutionsCount]="PREVIOUS_EXECUTIONS_TO_DISPLAY"
          />
        </div>
      </div>
    }
  </div>
</step-modal-window>
