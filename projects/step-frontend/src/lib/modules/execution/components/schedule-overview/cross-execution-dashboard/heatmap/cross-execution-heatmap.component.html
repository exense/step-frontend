<step-alt-report-widget class="flex-grow-1" [title]="dashletTitle()">
  <step-alt-report-widget-content class="widget-content">
    @if (isLoading() && _state.lastRefreshTrigger() !== 'auto') {
      <div class="spinner-container">
        <mat-spinner [diameter]="32" />
      </div>
    } @else {}
    <div [class.hidden]="isLoading() && _state.lastRefreshTrigger() !== 'auto'">
      @if (defaultDateRange(); as dateRange) {
        <div class="chart-actions-container">
          <step-tabs
            [tabs]="tabs"
            [shrink]="true"
            [activeTabId]="heatmapType()"
            (activeTabIdChange)="switchType($event)"
          />
        </div>

        <div class="table-container">
          @if (heatMapData$ | async; as heatmapData) {
            @if (heatmapData.truncated) {
              <div class="trimmed-heatmap-placeholder">
                <span>Results were trimmed (too much data). Refine filters to see the heatmap.</span>
              </div>
            } @else {
              <step-heatmap
                [rows]="heatmapData.data.rows"
                [columns]="heatmapData.data.columns"
                [legendColors]="legendColors"
              />
            }
          } @else {
            <div class="spinner-container">
              <mat-spinner [diameter]="32" />
            </div>
          }
        </div>
      }
    </div>
  </step-alt-report-widget-content>
</step-alt-report-widget>
