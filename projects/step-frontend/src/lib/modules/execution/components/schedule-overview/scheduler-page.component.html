<section class="header" [class.small-screen]="!!(_isSmallScreen$ | async)">
  @if (task(); as task) {
    <div class="title">
      <h3 data-step-testid>
        <entity-icon entityName="tasks" [entity]="task"></entity-icon>

        <div>{{ task.attributes?.['name'] }}</div>
        @if ((lastExecution$ | async)?.execution; as lastExecution) {
          <a
            class="plan-link"
            [routerLink]="['/plans/editor', lastExecution.planId]"
            matTooltip="Navigate to plan"
            matTooltipPosition="right"
          >
            <step-icon name="external-link" />
          </a>
        }
      </h3>
    </div>
    <div class="sub-title">
      @if (lastExecution$ | async; as lastExecutionResponse) {
        @if (lastExecutionResponse.execution; as lastExecution) {
          <step-alt-execution-time
            popoverTitle="Last execution"
            [startTime]="lastExecution.startTime"
            [endTime]="lastExecution.endTime"
            [isRunning]="lastExecution.status === 'RUNNING'"
          />
          <step-status [status]="lastExecution?.result" [iconMode]="false" />
        } @else {
          <div>No execution</div>
        }
      }
      <button type="button" mat-icon-button color="default" [matTooltip]="'Cron expression: ' + task.cronExpression">
        <step-icon name="clock" />
      </button>
    </div>
    <div class="controls">
      <step-autorefresh-toggle
        [interval]="refreshInterval()"
        (refresh)="triggerRefresh()"
        (intervalChange)="handleRefreshIntervalChange($event)"
      />
      @if (activeTimeRangeSelection()) {
        <div class="range-picker">
          <step-time-range-picker
            (selectionChange)="handleTimeRangeChange($event)"
            [selectOptions]="timeRangeOptions"
            [activeSelection]="activeTimeRangeSelection()!"
          />
        </div>
      }
    </div>
  }
</section>

<section class="main">
  <step-tabs [tabs]="tabs" [userRouteLinks]="true" />
  <router-outlet />
</section>
