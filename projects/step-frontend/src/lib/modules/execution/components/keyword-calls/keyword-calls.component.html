<ng-template #chevronRight>
  <mat-icon>chevron_right</mat-icon>
</ng-template>
<ng-template #chevronDown>
  <mat-icon>expand_more</mat-icon>
</ng-template>
<section class="header">
  <step-btn-group>
    <a href="#" (click)="toggleFooter(); (false)">
      {{ showFooter ? 'hide details' : 'display details' }}
    </a>
    <button
      type="button"
      mat-icon-button
      matTooltip="Export as CSV"
      matTooltipPosition="below"
      (click)="keywordsTable.exportAsCSV()"
    >
      <mat-icon>file_upload</mat-icon>
    </button>
  </step-btn-group>
</section>
<step-table
  #keywordsTable
  matSort
  matSortActive="executionTime"
  matSortDirection="desc"
  [dataSource]="leafReportsDataSource"
  [matSortDisableClear]="true"
  [tableParams]="(keywordParameters$ | async)!"
>
  <ng-container matColumnDef="executionTime">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Begin</th>
    <td mat-cell *matCellDef="let element" class="cell-execution-time">
      <div>
        <button type="button" mat-icon-button matTooltip="Show/hide details" (click)="toggleRowDetails(element.id)">
          <ng-container *ngIf="rowDetailsVisibilityFlags[element.id]; then chevronDown; else chevronRight">
          </ng-container>
        </button>
        <span>{{ element.executionTime | date: 'HH:mm:ss' }}</span>
      </div>
    </td>
  </ng-container>
  <ng-container matColumnDef="step" stepSearchCol #stepSearchColStep="SearchCol">
    <mat-form-field class="step-search" *stepSearchCellDef>
      <input matInput type="text" (change)="stepSearchColStep.search($event, true)" />
    </mat-form-field>
    <th mat-header-cell *matHeaderCellDef>Step</th>
    <td mat-cell *matCellDef="let element" class="cell-step">
      <step-report-node-short
        [node]="element"
        [showFooter]="showFooter"
        [showDetails]="rowDetailsVisibilityFlags[element.id]"
        [isShowTestCaseVisible]="execution?.executionType === 'TestSet'"
        (showNodeInTree)="showNodeInTree.emit($event)"
        (showTestCase)="showTestCase.emit($event)"
      >
      </step-report-node-short>
    </td>
  </ng-container>
  <ng-container matColumnDef="status" stepSearchCol #stepSearchColStatus="SearchCol">
    <step-array-filter
      *stepSearchCellDef
      [items]="(statusOptions$ | async)!"
      (selectedItemsChange)="stepSearchColStatus.search($event, true)"
    >
    </step-array-filter>
    <th mat-header-cell *matHeaderCellDef>Status</th>
    <td mat-cell *matCellDef="let element" class="cell-status">
      <step-report-node-status [status]="element.status"> </step-report-node-status>
    </td>
  </ng-container>
</step-table>
