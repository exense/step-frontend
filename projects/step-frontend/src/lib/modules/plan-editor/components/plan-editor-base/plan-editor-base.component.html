<div>
  <step-plan-alerts [planContext]="_planEditorService.planContext()" />
  @if (showInteractiveWarning$ | async) {
    <step-alert type="info">
      Welcome to the interactive mode. In this mode you can select tree nodes and run them directly by clicking the
      &nbsp;'Run interactively' button
    </step-alert>
  }
  <div class="actions-header">
    <div class="editable-labels">
      @if (planTypes$ | async; as planTypes) {
        <step-editable-dropdown-label [items]="planTypes" [formControl]="planTypeControl" tooltip="Plan type">
          <span *stepEditableLabelTemplate>Plan type</span>
          <div *stepEditableListItemTemplate="let item" class="plan-type-item">
            <step-icon [name]="item.icon" />
            {{ item.planType }}
          </div>
        </step-editable-dropdown-label>
      }
      <ng-content select="step-plan-editor-attributes" />
    </div>
    @if (_planEditorService.planContext(); as planContext) {
      <step-plan-editor-actions
        [planContext]="planContext"
        [showExecuteButton]="actionsConfig?.showExecuteButton"
        [showExportSourceButton]="actionsConfig?.showExportSourceButton"
        [hasUndo]="_planEditorService.hasUndo()"
        [hasRedo]="_planEditorService.hasRedo()"
        [isInteractiveSessionActive]="_interactiveSession.isActive$ | async"
        [repositoryObjectRef]="repositoryObjectRef"
        (discardAll)="_planEditorService.discardAll()"
        (undo)="_planEditorService.undo()"
        (redo)="_planEditorService.redo()"
        (clone)="clonePlan()"
        (export)="exportPlan()"
        (startInteractive)="startInteractive()"
        (reset)="resetInteractive()"
        (stop)="stopInteractive()"
        (showSource)="showPlanSource()"
        (runPlan)="runPlan.emit()"
        (targetExecutionParametersChange)="setTargetExecutionParameters($event)"
      />
    }
  </div>

  <section stepDragDropGroupContainer stepDropAreaId="planTree">
    @if (planClass) {
      <step-plan-type [itemKey]="planClass" [context]="{ templateControls: controls }" />
      <ng-template #controls>
        <step-plan-controls #planControls />
      </ng-template>
    }
  </section>
</div>
