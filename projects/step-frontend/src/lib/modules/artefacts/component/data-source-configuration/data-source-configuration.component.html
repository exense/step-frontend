<form #form="ngForm">
  <step-form-field>
    <step-label>Source type</step-label>
    <mat-select
      [ngModel]="context.artefact!.dataSourceType"
      (ngModelChange)="handleDataSourceTypeChange($event)"
      [ngModelOptions]="{ standalone: true }"
      [disabled]="context.readonly"
    >
      <mat-option [value]="undefined"></mat-option>
      @for (item of dataSourceTypes; track item.key) {
        <mat-option [value]="item.key">{{ item.value }}</mat-option>
      }
    </mat-select>
  </step-form-field>
  @if (context.artefact!.dataSource) {
    @switch (context.artefact!.dataSourceType) {
      @case (DataSourceType.EXCEL) {
        <step-dynamic-resource
          label="Excel file"
          type="datasource"
          [(ngModel)]="context.artefact!.dataSource!.file"
          [disabled]="context.readonly"
          name="file"
        />
        <step-dynamic-textfield
          label="Worksheet"
          [(ngModel)]="context.artefact!.dataSource!.worksheet"
          [disabled]="context.readonly"
          name="worksheet"
        />
        <step-dynamic-checkbox
          label="Headers"
          [(ngModel)]="context.artefact!.dataSource!.headers"
          [disabled]="context.readonly"
          name="headers"
        />
      }
      @case (DataSourceType.CSV) {
        <step-dynamic-resource
          label="CSV file"
          type="datasource"
          [(ngModel)]="context.artefact!.dataSource!.file"
          [disabled]="context.readonly"
          name="file"
        />
        <step-dynamic-textfield
          label="Delimiter"
          [(ngModel)]="context.artefact!.dataSource!.delimiter"
          [disabled]="context.readonly"
          name="delimiter"
        />
      }
      @case (DataSourceType.SQL) {
        <step-dynamic-textfield
          label="Connection string"
          [(ngModel)]="context.artefact!.dataSource!.connectionString"
          [disabled]="context.readonly"
          name="connectionString"
        />
        <step-dynamic-textfield
          label="Driver class"
          [(ngModel)]="context.artefact!.dataSource!.driverClass"
          [disabled]="context.readonly"
          name="driverClass"
        />
        <step-dynamic-textfield
          label="Query"
          [(ngModel)]="context.artefact!.dataSource!.query"
          [disabled]="context.readonly"
          name="query"
        />
        <step-dynamic-textfield
          label="User"
          [(ngModel)]="context.artefact!.dataSource!.user"
          [disabled]="context.readonly"
          name="user"
        />
        <step-dynamic-textfield
          label="Password"
          [(ngModel)]="context.artefact!.dataSource!.password"
          [disabled]="context.readonly"
          name="password"
        />
        <step-dynamic-textfield
          label="Primary write key"
          [(ngModel)]="context.artefact!.dataSource!.writePKey"
          [disabled]="context.readonly"
          name="writePKey"
        />
      }
      @case (DataSourceType.GSHEET) {
        <step-dynamic-resource
          label="Service Account Key File"
          type="secret"
          [(ngModel)]="context.artefact!.dataSource!.serviceAccountKey"
          [disabled]="context.readonly"
          name="serviceAccountKey"
        />
        <step-dynamic-textfield
          label="File Id"
          [(ngModel)]="context.artefact!.dataSource!.fileId"
          [disabled]="context.readonly"
          name="fileId"
        />
        <step-dynamic-textfield
          label="Tab Name"
          [(ngModel)]="context.artefact!.dataSource!.tabName"
          [disabled]="context.readonly"
          name="tabName"
        />
      }
      @case (DataSourceType.SEQUENCE) {
        <step-dynamic-textfield
          label="Start"
          [isNumber]="true"
          [(ngModel)]="context.artefact!.dataSource!.start"
          [disabled]="context.readonly"
          name="start"
        />
        <step-dynamic-textfield
          label="End"
          [isNumber]="true"
          [(ngModel)]="context.artefact!.dataSource!.end"
          [disabled]="context.readonly"
          name="end"
        />
        <step-dynamic-textfield
          label="Inc"
          [isNumber]="true"
          [(ngModel)]="context.artefact!.dataSource!.inc"
          [disabled]="context.readonly"
          name="inc"
        />
      }
      @case (DataSourceType.JSON_ARRAY) {
        <step-dynamic-textfield
          label="Json"
          [(ngModel)]="context.artefact!.dataSource!.json"
          [disabled]="context.readonly"
          name="json"
          [predefinedRichEditorMode]="AceMode.JSON"
        />
      }
      @case (DataSourceType.JSON) {
        <step-dynamic-textfield
          label="Json string"
          [(ngModel)]="context.artefact!.dataSource!.json"
          [disabled]="context.readonly"
          [predefinedRichEditorMode]="AceMode.JSON"
          name="json"
        />
      }
      @case (DataSourceType.FILE) {
        <step-dynamic-resource
          label="Flat file"
          type="datasource"
          [(ngModel)]="context.artefact!.dataSource!.file"
          [disabled]="context.readonly"
          name="file"
        />
      }
      @case (DataSourceType.FOLDER) {
        <step-dynamic-textfield
          label="Directory"
          [(ngModel)]="context.artefact!.dataSource!.folder"
          [disabled]="context.readonly"
          name="folder"
        />
      }
      @default {}
    }
  }
</form>
