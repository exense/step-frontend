<section class="page-header">
  <a
    [routerLink]="['..']"
    [relativeTo]="_activatedRoute"
    matTooltip="Back to automation packages"
    matTooltipPosition="below"
  >
    <step-icon name="chevron-left" class="black" aria-hidden="true" />
  </a>
  <h3>Package Libraries</h3>
</section>
<step-drag-drop-container>
  <step-table
    data-step-testid="automation-packages-library-library-table"
    #table
    [dataSource]="dataSource"
    matSort
    [matSortDisableClear]="true"
    [filter]="AP_RESOURCE_LIBRARY_FILTER"
  >
    <step-bulk-operations *stepAdditionalHeader="'btngroup-bulk-import-create'" entity="automationPackageLibrary" />
    <section class="header" *stepAdditionalHeader="'btngroup-bulk-import-create'">
      <step-btn-group>
        <a
          data-step-testid="new-library-btn"
          mat-mini-fab
          color="primary"
          matTooltip="New automation package library"
          matTooltipPosition="below"
          [disabled]="!('resource-write' | hasRight | async)"
          [routerLink]="['.', 'upload', 'new']"
          [relativeTo]="_activatedRoute"
        >
          <step-icon name="plus"></step-icon>
        </a>
      </step-btn-group>
    </section>
    <ng-container matColumnDef="bulkSelection">
      <th mat-header-cell *matHeaderCellDef class="bulk-selection-cell"></th>
      <td mat-cell *matCellDef="let element">
        <step-entity-selection [entity]="element" />
      </td>
    </ng-container>
    <step-entity-column-container entityName="automationPackageLibrary" />
    <ng-container matColumnDef="name" stepActivityCol="Name" stepSearchCol>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <step-drag-column-caption>Name</step-drag-column-caption>
      </th>
      <td mat-cell *matCellDef="let element">
        @if (element.resourceType === AutomationPackageResourceType.AUTOMATION_PACKAGE_MANAGED_LIBRARY) {
          <a class="resource-link" [routerLink]="['.', 'upload', element.id]" [relativeTo]="_activatedRoute">
            {{ element.attributes.name }}
          </a>
        } @else {
          {{ element.attributes.name }}
        }
      </td>
    </ng-container>
    <ng-container matColumnDef="resourceType" stepActivityCol="Type" stepSearchCol>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <step-drag-column-caption>Type</step-drag-column-caption>
      </th>
      <td mat-cell *matCellDef="let element">
        <step-resource-info [resource]="element">
          {{ element.resourceType }}
        </step-resource-info>
      </td>
    </ng-container>
    <ng-container matColumnDef="id" stepActivityCol="Id" stepSearchCol>
      <step-input-filter
        data-step-testid="id-input"
        *stepSearchCellDef
        stepFilterConnect
        [useRegex]="false"
      ></step-input-filter>
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <step-drag-column-caption>Id</step-drag-column-caption>
      </th>
      <td mat-cell *matCellDef="let element">{{ element.id }}</td>
    </ng-container>
    <ng-container matColumnDef="automationPackage" stepActivityCol="Automation package" stepSearchCol>
      <step-automation-package-filter *stepSearchCellDef stepFilterConnect />
      <th class="automation-package-cell" mat-header-cell *matHeaderCellDef>
        <step-drag-column-caption>&nbsp;</step-drag-column-caption>
      </th>
      <td mat-cell *matCellDef="let element">
        <step-automation-package-ref-icon [entity]="element" />
      </td>
    </ng-container>
    <ng-container matColumnDef="actions" stepActionCol>
      <th mat-header-cell *matHeaderCellDef>
        Actions
        <step-column-settings />
      </th>
      <td mat-cell *matCellDef="let element" class="cell-actions">
        <step-btn-group [stepEntityRef]="element">
          <button
            data-step-testid="download-library-btn"
            mat-icon-button
            matTooltip="Download library"
            (click)="downloadResource(element.id)"
          >
            <step-icon name="download-cloud" />
          </button>
          <button
            data-step-testid="search-library-btn"
            mat-icon-button
            matTooltip="Search for library"
            (click)="searchUsages(element)"
          >
            <step-icon name="search" />
          </button>
          <button
            data-step-testid="refresh-library-btn"
            mat-icon-button
            matTooltip="Refresh library"
            [disabled]="!('resource-write' | hasRight | async)"
            (click)="refreshResource(element)"
          >
            <step-icon name="refresh-cw" />
          </button>
          <button
            data-step-testid="delete-library-btn"
            mat-icon-button
            matTooltip="Delete library"
            [disabled]="!('resource-delete' | hasRight | async)"
            (click)="deleteResource(element.id, element.resourceName)"
          >
            <step-icon name="trash-2">delete</step-icon>
          </button>
        </step-btn-group>
      </td>
    </ng-container>
  </step-table>
</step-drag-drop-container>
<router-outlet />
