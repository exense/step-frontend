<step-modal-window title="Chart settings" [stepZIndex]="1000">
  <div step-modal-window-body>
    <ng-container *ngIf="item">
      <step-form-field>
        <step-label>Name</step-label>
        <input placeholder="Dashlet name" [(ngModel)]="item.name" />
      </step-form-field>

      <step-form-field>
        <step-label>Type</step-label>
        <input disabled placeholder="Type" [value]="item.type" />
      </step-form-field>

      <step-form-field>
        <step-label>Metric</step-label>
        <input disabled placeholder="Metric" [value]="item.chartSettings!.metricKey" />
      </step-form-field>

      <div class="section">
        <div>Attributes</div>
        <table class="attributes-table">
          <thead>
            <th>Display Name</th>
            <th>Value</th>
          </thead>
          <tbody>
            <tr *ngFor="let attr of item.chartSettings!.attributes">
              <td><input class="hidden-input" [(ngModel)]="attr.displayName" /></td>
              <td><input class="hidden-input" [(ngModel)]="attr.name" /></td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top: 4px; cursor: pointer" (click)="addAttribute()">
          <step-icon style="transform: scale(0.9)" name="plus"></step-icon>
          <span>Add attribute</span>
        </div>
      </div>

      <div style="margin-top: 12px">
        <mat-checkbox color="primary" [(ngModel)]="item.chartSettings!.inheritGlobalFilters">
          <span>Inherit global filters</span>
          <step-icon
            class="help-icon"
            matTooltip="The chart filters will be combined with the dashboard filters"
            name="help-circle"
          ></step-icon>
        </mat-checkbox>
      </div>

      <div>
        <mat-checkbox color="primary" [(ngModel)]="item.chartSettings!.inheritGlobalGrouping">
          <span>Inherit global grouping</span>
          <step-icon
            class="help-icon"
            matTooltip="The grouping will be inherited from the dashboard level"
            name="help-circle"
          ></step-icon>
        </mat-checkbox>
      </div>

      <div>
        <mat-checkbox color="primary" [(ngModel)]="item.chartSettings!.readonlyGrouping">
          <span>Readonly grouping</span>
          <step-icon
            class="help-icon"
            matTooltip="The users will not be able to change the grouping of this dashlet"
            name="help-circle"
          ></step-icon>
        </mat-checkbox>
      </div>

      <div>
        <mat-checkbox color="primary" [(ngModel)]="item.chartSettings!.readonlyAggregate">
          <span>Readonly aggregate</span>
          <step-icon
            class="help-icon"
            matTooltip="The users will not be able to change the aggregate of this dashlet"
            name="help-circle"
          ></step-icon>
        </mat-checkbox>
      </div>

      <step-form-field *ngIf="!item.chartSettings!.inheritGlobalGrouping">
        <step-label>Grouping</step-label>
        <!--        <mat-chip-grid #chipGrid aria-label="Fruit selection">-->
        <!--          <mat-chip-row *ngFor="let attr of item.chartSettings!.attributes">-->
        <!--            {{attr.displayName}}-->
        <!--            <button matChipRemove>-->
        <!--              <mat-icon>cancel</mat-icon>-->
        <!--            </button>-->
        <!--          </mat-chip-row>-->
        <!--        </mat-chip-grid>-->
        <mat-select [(ngModel)]="item.chartSettings!.grouping" multiple>
          <mat-option *ngFor="let attr of item.chartSettings!.attributes" [value]="attr.name">{{
            attr.displayName
          }}</mat-option>
        </mat-select>
      </step-form-field>
      <step-form-field>
        <step-label>Chart width</step-label>
        <mat-select [(ngModel)]="item.size">
          <mat-option [value]="1">50%</mat-option>
          <mat-option [value]="2">100%</mat-option>
        </mat-select>
      </step-form-field>

      <step-form-field>
        <step-label>Aggregate</step-label>
        <mat-select [(ngModel)]="item.chartSettings!.primaryAxes.aggregation">
          <mat-option *ngFor="let attr of AGGREGATE_TYPES" [value]="attr">{{ attr }}</mat-option>
        </mat-select>
      </step-form-field>

      <step-form-field>
        <step-label>Unit</step-label>
        <input placeholder="Series units, like 'ms', 'hrs', '%'" [(ngModel)]="item.chartSettings!.primaryAxes.unit" />
      </step-form-field>

      <step-form-field>
        <step-label>Chart display</step-label>
        <mat-select [(ngModel)]="item.chartSettings!.primaryAxes.displayType">
          <mat-option [value]="'LINE'" class="option-with-icon">
            <div style="display: flex; align-items: center; gap: 12px">
              <step-icon name="trending-up"></step-icon>
              <span>Line chart</span>
            </div>
          </mat-option>
          <mat-option [value]="'BAR_CHART'" class="option-with-icon">
            <div style="display: flex; align-items: center; gap: 12px">
              <step-icon name="bar-chart-2"></step-icon>
              <span>Bar chart</span>
            </div>
          </mat-option>
        </mat-select>
      </step-form-field>

      <!--      <step-form-field>-->
      <!--        <step-label>Type</step-label>-->
      <!--        <mat-select-->
      <!--          [ngModel]="formGroup!.controls.type.value"-->
      <!--          (ngModelChange)="fetchStepFunction($event)"-->
      <!--          [ngModelOptions]="{ standalone: true }"-->
      <!--        >-->
      <!--          <mat-option *ngFor="let itemInfo of functionTypeItemInfos" [value]="itemInfo.type">-->
      <!--            {{ itemInfo.label }}-->
      <!--          </mat-option>-->
      <!--        </mat-select>-->
      <!--      </step-form-field>-->
    </ng-container>
  </div>

  <div step-modal-window-buttons>
    <button type="button" mat-stroked-button mat-dialog-close>Cancel</button>
    <button type="button" (click)="submitForm()" mat-flat-button color="primary">Apply</button>
  </div>
</step-modal-window>
