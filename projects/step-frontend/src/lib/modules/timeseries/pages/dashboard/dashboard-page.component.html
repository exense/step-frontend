<div *ngIf="dashboard" style="margin: 12px">
  <div style="font-size: 24px">{{ dashboard.name }}</div>

  <div>
    <step-ts-dashboard-filter-bar
      *ngIf="context"
      [context]="context"
      [filters]="dashboard.filters || []"
      (onTimeRangeChange)="handleTimeRangeChange($event)"
      [timeRangeOptions]="timeRangeOptions"
      [activeTimeRange]="timeRangeSelection"
      [compactView]="compareModeEnabled"
    >
    </step-ts-dashboard-filter-bar>
  </div>

  <div style="width: 100%; flex-direction: row; flex-wrap: wrap; display: flex">
    <div
      *ngFor="let config of chartConfigs"
      style="height: 300px; width: 500px; margin-top: 40px; margin-right: 40px; position: relative"
    >
      <step-chart-dashlet [item]="config.state" [context]="context"></step-chart-dashlet>
    </div>
  </div>
</div>

<ng-template #menuTemplate let-config>
  <div class="settings-container">
    <button mat-icon-button matTooltip="Settings" [matMenuTriggerFor]="settingsMenu">
      <step-icon name="settings"></step-icon>
    </button>

    <mat-menu #settingsMenu="matMenu">
      <button *ngIf="!config.state?.chartSettings?.readonlyGrouping" mat-menu-item [matMenuTriggerFor]="groupingMenu">
        Grouping
      </button>
      <!--        <button mat-menu-item [matMenuTriggerFor]="aggregateMenu">Aggregate</button>-->
    </mat-menu>

    <mat-menu #groupingMenu="matMenu">
      <button
        *ngFor="let attribute of config.groupingAttributes"
        (click)="toggleGroupingAttribute(config, attribute); $event.stopPropagation()"
        mat-menu-item
        [class.selected-menu-item]="attribute.selected"
      >
        <div class="flex flex-row checkbox-row">
          <input type="checkbox" class="checkbox" [ngModel]="attribute.selected" />
          <span>{{ attribute.displayName }}</span>
        </div>
      </button>
    </mat-menu>

    <!--      <mat-menu #aggregateMenu="matMenu">-->
    <!--        <button-->
    <!--          *ngFor="let aggregate of AGGREGATES"-->
    <!--          (click)="switchAggregate(aggregate)"-->
    <!--          mat-menu-item-->
    <!--          [class.selected-menu-item]="aggregate === selectedAggregate"-->
    <!--        >-->
    <!--          {{ aggregate }}-->
    <!--        </button>-->
    <!--        <button-->
    <!--          mat-menu-item-->
    <!--          [matMenuTriggerFor]="pclMenu"-->
    <!--          [class.selected-menu-item]="selectedAggregate === 'PERCENTILE'"-->
    <!--        >-->
    <!--          PERCENTILE-->
    <!--        </button>-->
    <!--      </mat-menu>-->

    <!--      <mat-menu #pclMenu="matMenu">-->
    <!--        <button-->
    <!--          *ngFor="let pcl of PCL_VALUES"-->
    <!--          (click)="selectedPclValue = pcl; switchAggregate('PERCENTILE')"-->
    <!--          [class.selected-menu-item]="selectedAggregate === 'PERCENTILE' && selectedPclValue === pcl"-->
    <!--          mat-menu-item-->
    <!--        >-->
    <!--          {{ pcl }}th-->
    <!--        </button>-->
    <!--      </mat-menu>-->
  </div>
</ng-template>
