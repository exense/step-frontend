<div ng-controller="CallFunctionCtrl">
  <div ng-if="!targetFunction.useCustomTemplate && ready">
    <div class="form-group" ng-if="artefact.functionId">
      <label>Keyword</label>
      <div class="input-group">
        <input ng-disabled="true" type="text" class="form-control" ng-model="targetFunction.attributes.name" />
        <span class="input-group-btn">
          <button ng-if="targetFunction" class="btn btn-default" type="button" ng-click="gotoFunction()">
            <step-ajs-icon name="tool" aria-hidden="true"></step-ajs-icon>
          </button>
          <button ng-if="targetFunction" class="btn btn-default" type="button" ng-click="openFunctionEditor()">
            <step-ajs-icon name="edit-2" aria-hidden="true"></step-ajs-icon>
          </button>
          <button class="btn btn-default" type="button" ng-disabled="readonly" ng-click="selectFunction()">
            Select
          </button>
        </span>
      </div>
    </div>
    <fieldset ng-if="!artefact.functionId">
      <step-keyword-name
        [artefact]="artefact"
        [is-disabled]="readonly"
        (on-save)="save()"
        (keyword-update)="onUpdateKeyword($event)">
      </step-keyword-name>
    </fieldset>

    <fieldset ng-disabled="readonly">
      <step-editable-textarea-label
        label="Add text description"
        [value]="artefact.description"
        (value-change)="artefact.description = $event; save()"
        [is-disabled]="readonly">
      </step-editable-textarea-label>
      <dynamic-json-editor label="'Input'" enforce-groovy-expression="true" dynamic-value="artefact.argument" on-save="save()" schema="keyword.schema" is-disabled="readonly" />
      <dynamic-textfield label="'Map output to'" dynamic-value="artefact.resultMap" on-save="save()" />

      <div class="panel panel-default">
        <div class="panel-heading">
          <a ng-click="showTokenSelectionParameters = !showTokenSelectionParameters">Keyword routing</a>
        </div>
        <div class="panel-body" ng-show="showTokenSelectionParameters">
          <dynamic-checkbox
            label="'Execute on agents'"
            dynamic-value="artefact.remote"
            on-save="save()"
            tooltip="'Defines if the Keyword has to be executed on an agent or locally on the controller.'"
          />
          <dynamic-json-editor label="'Agent token selectors'" dynamic-value="artefact.token" on-save="save()" />
        </div>
      </div>
    </fieldset>
  </div>
  <custom-json-editor
    ng-if="targetFunction.useCustomTemplate && ready"
    compile-html="targetFunction.htmlTemplate"
    args-value="artefact.argument.value"
    on-save="save()"
  />
</div>
