<step-modal-window [title]="isNew ? 'New task' : 'Edit task'">
  <div step-modal-window-body>
    <step-alert *ngIf="error" type="danger">
      {{ error }}
    </step-alert>
    <form #formContainer="ngForm">
      <step-form-field>
        <step-label>Name</step-label>
        <input type="text" placeholder="Name" required [(ngModel)]="_task.attributes!['name']" name="name" />
      </step-form-field>
      <step-select-plan required [ngModel]="plan" (ngModelChange)="handlePlanChange($event)" name="plan">
      </step-select-plan>
      <step-form-field>
        <step-label>CRON expression</step-label>
        <input
          type="text"
          placeholder="CRON expression"
          required
          stepValidateCron
          [(ngModel)]="_task.cronExpression"
          name="cron"
        />
        <step-suffix class="button-suffix">
          <button
            type="button"
            mat-stroked-button
            color="primary"
            matTooltip="Configure CRON expression"
            (click)="configureCronExpression()"
          >
            <step-icon name="watch"></step-icon>
          </button>
        </step-suffix>
      </step-form-field>
      <step-form-field>
        <step-label>Description</step-label>
        <input
          type="text"
          placeholder="Description"
          [ngModel]="_task.attributes!['description']"
          (ngModelChange)="handleDescriptionChange($event)"
          name="description"
        />
      </step-form-field>
      <step-custom-forms
        [stModel]="_task.executionsParameters!.customParameters!"
        (stModelChange)="handleCustomParametersChange($event)"
        stScreen="executionParameters"
      >
      </step-custom-forms>
      <step-form-field>
        <step-label>User</step-label>
        <input
          type="text"
          placeholder="User"
          [ngModel]="_task.executionsParameters!.userID"
          (ngModelChange)="handleUserIdChange($event)"
          name="user"
        />
      </step-form-field>
      <step-dashlet itemKey="taskAddon" [context]="_task"></step-dashlet>
      <mat-expansion-panel [(expanded)]="showParameters">
        <mat-expansion-panel-header>
          <mat-panel-title>Advanced</mat-panel-title>
        </mat-expansion-panel-header>
        <section class="advanced-body">
          <step-form-field>
            <step-label>Parameters</step-label>
            <textarea
              rows="7"
              [ngModel]="parametersRawValue"
              (ngModelChange)="handleParametersRawValueChange($event)"
              [ngModelOptions]="rawValueModelOptions"
              name="parameters"
              stepValidateJson
              #parametersJson="ngModel"
            >
            </textarea>
            <step-error *ngIf="parametersJson.invalid && parametersJson.touched">
              This field's value should be in JSON format
            </step-error>
          </step-form-field>
        </section>
      </mat-expansion-panel>
    </form>
  </div>
  <div step-modal-window-buttons>
    <button type="button" mat-stroked-button mat-dialog-close>Cancel</button>
    <button type="button" mat-flat-button color="primary" (click)="save()">Save</button>
  </div>
</step-modal-window>
