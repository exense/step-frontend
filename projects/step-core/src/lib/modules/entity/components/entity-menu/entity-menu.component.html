<mat-menu #menu="matMenu">
  <div
    *matMenuContent="let element = element"
    [stepItemHover]="element"
    [stepEntityRef]="element"
    #entityRef="EntityRef"
  >
    @if (menuContent?.templateRef; as templateRef) {
      <ng-container *ngTemplateOutlet="templateRef; context: { $implicit: element }; injector: entityRef._injector" />
    }
    @for (item of menuItems; track item.menuId) {
      <button
        type="button"
        mat-menu-item
        [stepEntityMenuItem]="item"
        [entity]="element"
        #menuItem="EntityMenuItem"
        [disabled]="!!(menuItem.isDisabled$ | async)"
        [class.hidden]="!(menuItem.isVisible$ | async)"
        (click)="menuItem.invoke()"
      >
        @if (item.icon) {
          <step-icon [name]="item.icon" />
        }
        {{ item.label }}
      </button>
    }
  </div>
</mat-menu>
