<div class="spinner-container" *ngIf="(tableDataSource?.inProgress$ | async) || inProgress">
  <mat-spinner></mat-spinner>
</div>
<ng-container *ngFor="let additionalHeaderGroup of additionalHeaderGroups">
  <div class="additional-header" [class.additional-header-flex]="!!additionalHeaderGroup[1]">
    <ng-container *ngFor="let additionalHeader of additionalHeaderGroup">
      <ng-container *ngTemplateOutlet="additionalHeader!.template"></ng-container>
    </ng-container>
  </div>
</ng-container>

<div class="table-container">
  <table mat-table [dataSource]="tableDataSource!" [trackBy]="trackBy">
    <ng-container
      *ngFor="let searchCol of searchColumns; trackBy: trackBySearchColumn"
      [matColumnDef]="searchCol.colName"
    >
      <th mat-header-cell *matHeaderCellDef>
        <ng-template #defaultSearchRender>
          <ng-container *ngIf="searchCol" [stepSearchColMeta]="searchCol">
            <step-input-filter stepFilterConnect> </step-input-filter>
          </ng-container>
        </ng-template>
        <ng-container *ngIf="searchCol.searchName">
          <ng-container *ngIf="!!searchCol.template; then searchCol.template!; else defaultSearchRender">
          </ng-container>
        </ng-container>
      </th>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
    <ng-container *ngIf="displaySearchColumns.length > 0">
      <tr mat-header-row *matHeaderRowDef="displaySearchColumns"></tr>
    </ng-container>
    <tr mat-row *matRowDef="let row; columns: displayColumns"></tr>
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell no-data" [colSpan]="displayColumns.length">
        <ng-container *ngIf="(tableDataSource?.total$ | async) === 0; then noTotal; else noSearch"></ng-container>
        <ng-template #noTotal> No data available in table </ng-template>
        <ng-template #noSearch> No matching records found </ng-template>
      </td>
    </tr>
  </table>
</div>
<mat-paginator
  [disabled]="pageSizeInputDisabled"
  [length]="tableDataSource?.totalFiltered$ | async"
  [pageSizeOptions]="pageSizeOptions"
>
</mat-paginator>
