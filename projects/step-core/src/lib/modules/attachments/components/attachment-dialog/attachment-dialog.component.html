<step-modal-window>
  <div step-modal-window-title>
    <div>{{ _data.name }}</div>
    @if (attachmentType === AttachmentType.TEXT) {
      <button
        type="button"
        tabindex="-1"
        mat-icon-button
        matTooltip="Copy all"
        matTooltipPosition="below"
        (click)="copyTextContentToClipboard()"
      >
        <step-icon name="copy" />
      </button>
    }
    @if (attachmentType === AttachmentType.STREAMING_TEXT) {
      <section class="streaming-info">
        @if (isStreamingInProgress() || areLinesRequestInProgress()) {
          <mat-spinner [diameter]="25" />
        }
        @if (isStreamingFailed()) {
          <step-alert
            class="incomplete"
            type="warning"
            matTooltip="The attachment stream ended unexpectedly before it could complete."
            matTooltipPosition="below"
            >File incomplete</step-alert
          >
        }
        @if (frameMessage(); as message) {
          <div>{{ message }}</div>
        }
        @if (isStreamingInProgress()) {
          <button
            type="button"
            mat-stroked-button
            class="rounded-icon-button"
            [class.active]="scrollDownOnRefresh()"
            (click)="toggleScrollDownOnRefresh()"
            matTooltip="Scroll down on refresh"
            matTooltipPosition="below"
            tabindex="-1"
          >
            <step-icon name="arrow-down" />
          </button>
        }
      </section>
    }
  </div>
  <div step-modal-window-body>
    @switch (attachmentType) {
      @case (AttachmentType.IMG) {
        <div class="media-container">
          <img [ngSrc]="(_data | attachmentUrl)!" fill />
        </div>
      }
      @case (AttachmentType.VIDEO) {
        <div class="media-container">
          <video controls>
            <source [src]="_data | attachmentUrl" />
          </video>
        </div>
      }
      @case (AttachmentType.TEXT) {
        <step-rich-editor #richEditor [formControl]="contentCtrl" />
      }
      @case (AttachmentType.STREAMING_TEXT) {
        <step-streaming-text
          #streamingText
          [attachment]="_data"
          [linesFrame]="1000"
          [(scrollDownOnRefresh)]="scrollDownOnRefresh"
        />
      }
      @case (AttachmentType.SKIPPED) {
        <div class="media-container">
          <p class="max-width-600">{{ $any(_data).reason }}</p>
        </div>
      }
      @default {}
    }
  </div>
  <div step-modal-window-buttons>
    <button type="button" mat-stroked-button mat-dialog-close>Close</button>
    @if (attachmentType !== AttachmentType.SKIPPED && !isStreamingInProgress() && !isStreamingFailed()) {
      <button type="button" mat-flat-button color="primary" (click)="download()">Download</button>
    }
  </div>
</step-modal-window>
