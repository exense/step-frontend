<step-expression-input
  *ngIf="dynamic; else constantValueTemplate"
  [label]="label"
  [tooltip]="tooltip"
  [placeholder]="placeholder"
  [isParentInvalid]="!!_ngControl.invalid"
  [isParentTouched]="!!_ngControl.touched"
  [isParentDisabled]="isDisabled"
  [showRequiredMarker]="showRequiredMarker"
  [ngModel]="expression"
  (ngModelChange)="onExpressionChange($event)"
  [disabled]="isDisabled"
  (toggleConstantValue)="toggleDynamicExpression(false)"
  (blur)="onBlur()"
></step-expression-input>

<ng-template #constantValueTemplate>
  <step-form-field
    [class.ng-invalid]="!!_ngControl.invalid"
    [class.ng-touched]="_ngControl.touched"
    [class.with-tooltip]="tooltip"
  >
    <step-label [attr.show-required-marker]="showRequiredMarker || null" *ngIf="label">{{ label }}</step-label>
    <ng-template #numberField>
      <input
        type="number"
        [placeholder]="placeholder"
        [ngModel]="value"
        (ngModelChange)="onValueChange($event)"
        [disabled]="isDisabled"
        (blur)="onBlur()"
        [stepPreventChars]="numberInputInvalidChars"
      />
    </ng-template>
    <ng-template #textField>
      <input
        type="text"
        [placeholder]="placeholder"
        [ngModel]="value"
        (ngModelChange)="onValueChange($event)"
        [disabled]="isDisabled"
        (blur)="onBlur()"
      />
    </ng-template>
    <ng-container *ngIf="isNumber; then numberField; else textField"> </ng-container>
    <step-suffix *ngIf="tooltip" class="icon-suffix">
      <step-icon name="help-circle" [matTooltip]="tooltip" matTooltipPosition="below"></step-icon>
    </step-suffix>
    <step-suffix class="button-suffix">
      <button type="button" mat-stroked-button (click)="editConstantValue()" [disabled]="isDisabled">
        <step-icon name="edit-2"></step-icon>
      </button>
    </step-suffix>
    <step-suffix class="button-suffix">
      <button
        type="button"
        mat-stroked-button
        matTooltip="Use a dynamic expression to set this attribute"
        matTooltipPosition="below"
        (click)="toggleDynamicExpression(true)"
        [disabled]="isDisabled"
      >
        <step-icon name="zap"></step-icon>
      </button>
    </step-suffix>
  </step-form-field>
</ng-template>
