@use '@angular/material' as mat;
@use 'sass:map';
@use 'step-tabs';
@use 'step-sidebar';
@use 'step-header';
@use 'step-icon';
@use 'step-inputs';
@use 'step-login';
@use 'step-dialogs';
@use 'step-buttons';
@use 'step-menu';
@use 'step-datepicker';

@forward 'step-sidebar' show step-define-sidebar-config;
@forward 'step-header' show step-define-header-config;

$dark-primary-text: #293e50;
$light-primary-text: white;

@function extend-mat-theme($theme, $overrides) {
  $color: map.get($theme, color);
  $foreground: map.get($color, foreground);

  $foreground-ext: map.merge(
    $foreground,
    (
      secondary-text: map.get($overrides, secondary-text),
      base: map.get($overrides, base),
      icon: map.get($overrides, icon),
      text: map.get($overrides, text),
    )
  );

  $result: map.merge(
    $color,
    (
      foreground: $foreground-ext,
    )
  );

  @return $result;
}

@function step-default-primary-palette() {
  $step-palette: (
    50: #e6f3fa,
    100: #b3daf0,
    200: #80c0e6,
    300: #4da8dc,
    400: #339bd7,
    500: #0082cb,
    600: #005180,
    700: #004166,
    800: #00304c,
    900: #002033,
    contrast: (
      50: $dark-primary-text,
      100: $dark-primary-text,
      200: $dark-primary-text,
      300: $dark-primary-text,
      400: $dark-primary-text,
      500: $light-primary-text,
      600: $light-primary-text,
      700: $light-primary-text,
      800: $light-primary-text,
      900: $light-primary-text,
    ),
  );

  @return mat.define-palette($step-palette, 500);
}

@function step-default-typography() {
  $result: mat.define-typography-config(
    $font-family: 'Roboto',
    $body-1: mat.define-typography-level(12px, 16px, 400),
    $body-2: mat.define-typography-level(14px, 20px, 500),
    $button: mat.define-typography-level(14px, 20px, 500),
  );

  @return $result;
}

@mixin step-theme(
  $text-color: $dark-primary-text,
  $mat-primary-palette: null,
  $mat-typography-config: null,
  $mat-accent-palette: null,
  $step-sidebar-config: null,
  $step-header-config: null,
  $step-login-config: null
) {
  @if not $mat-primary-palette {
    $mat-primary-palette: step-default-primary-palette();
  }

  @if not $mat-typography-config {
    $mat-typography-config: step-default-typography();
  }

  @if not $mat-accent-palette {
    $mat-accent-palette: mat.define-palette(mat.$pink-palette);
  }

  $mat-theme: mat.define-light-theme(
    (
      color: (
        primary: $mat-primary-palette,
        accent: $mat-accent-palette,
      ),
    )
  );

  $mat-theme-ext: extend-mat-theme(
    $mat-theme,
    (
      secondary-text: $text-color,
      base: $text-color,
      icon: $text-color,
      text: $text-color,
    )
  );

  font-family: map-get($mat-typography-config, font-family);
  @include mat.core($mat-typography-config);
  @include mat.all-component-themes($mat-theme-ext);

  $primary-color: map-get($mat-primary-palette, default);

  @include step-tabs.tabbar($primary-color);
  @include step-sidebar.sidebar($step-sidebar-config);
  @include step-header.header($step-header-config);

  $inputs-config: step-inputs.step-define-inputs-config(
    $primary-color: $primary-color,
  );

  @include step-inputs.inputs($inputs-config);

  @include step-login.login-page($step-login-config, $mat-primary-palette);

  @include step-dialogs.dialogs();
  @include step-buttons.buttons();
  @include step-menu.menu();
  @include step-datepicker.datepicker();

  .cdk-overlay-pane {
    padding-top: 8px;
  }

  &.modal-open .cdk-overlay-container {
    z-index: 1049;
  }

  color: $text-color;
  line-height: 16px;

  .mat-mini-fab {
    box-shadow: none !important;
    width: 36px;
    height: 36px;
  }

  .mat-button-wrapper {
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;

    step-icon {
      display: flex;
      margin-top: 0 !important;
    }
  }

  @include step-icon.step-icon();

  step-dynamic-field,
  step-dynamic-textfield,
  step-expression-input,
  step-resource-input {
    .mat-button-wrapper {
      @include step-icon.step-icon(16px);
    }
  }

  .btn-xs {
    @include step-icon.step-icon(12px);
    step-icon,
    step-ajs-icon,
    .step-ajs-icon {
      vertical-align: text-top;
    }
  }
  .btn-sm,
  .btn-auto-size,
  a:not(.jstree-anchor) {
    @include step-icon.step-icon(16px);
    step-icon,
    step-ajs-icon,
    .step-ajs-icon {
      vertical-align: top;
    }
  }

  label + step-ajs-icon {
    @include step-icon.step-icon-size(16px);
    vertical-align: text-top;
  }

  .jstree-icon.step-ajs-icon {
    @include step-icon.step-icon-size(18px);
    margin-top: -2px;
  }

  tbody .form-group {
    margin-bottom: 15px;
  }

  .mat-accordion .mat-expansion-panel:first-of-type {
    border-top-right-radius: 0;
    border-top-left-radius: 0;
  }

  .mat-accordion .mat-expansion-panel:last-of-type {
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 0;
  }

  .mat-accordion > .mat-expansion-panel:first-child,
  .mat-accordion > *:first-child .mat-expansion-panel {
    border-top-right-radius: 8px;
    border-top-left-radius: 8px;
  }

  .mat-accordion > .mat-expansion-panel:last-child,
  .mat-accordion > *:last-child .mat-expansion-panel {
    border-bottom-right-radius: 8px;
    border-bottom-left-radius: 8px;
  }

  .mat-card {
    border-radius: 8px;
  }

  .mat-tooltip {
    white-space: pre-line;
  }
}
